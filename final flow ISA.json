{
  "data": {
    "edges": [
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "ChatInput",
            "id": "ChatInput-xJqpF",
            "name": "message",
            "output_types": [
              "Message"
            ]
          },
          "targetHandle": {
            "fieldName": "input_value",
            "id": "OllamaModel (rLaRF)-BmD8c",
            "inputTypes": [
              "Message"
            ],
            "type": "str"
          }
        },
        "id": "xy-edge__ChatInput-xJqpF{œdataTypeœ:œChatInputœ,œidœ:œChatInput-xJqpFœ,œnameœ:œmessageœ,œoutput_typesœ:[œMessageœ]}-OllamaModel (rLaRF)-BmD8c{œfieldNameœ:œinput_valueœ,œidœ:œOllamaModel (rLaRF)-BmD8cœ,œinputTypesœ:[œMessageœ],œtypeœ:œstrœ}",
        "selected": false,
        "source": "ChatInput-xJqpF",
        "sourceHandle": "{œdataTypeœ:œChatInputœ,œidœ:œChatInput-xJqpFœ,œnameœ:œmessageœ,œoutput_typesœ:[œMessageœ]}",
        "target": "OllamaModel (rLaRF)-BmD8c",
        "targetHandle": "{œfieldNameœ:œinput_valueœ,œidœ:œOllamaModel (rLaRF)-BmD8cœ,œinputTypesœ:[œMessageœ],œtypeœ:œstrœ}"
      },
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "CustomAgent (DMwhm)",
            "id": "CustomAgent (DMwhm)-Bmybo",
            "name": "response",
            "output_types": [
              "Message"
            ]
          },
          "targetHandle": {
            "fieldName": "input_value",
            "id": "ChatOutput-AbRpQ",
            "inputTypes": [
              "Data",
              "DataFrame",
              "Message"
            ],
            "type": "other"
          }
        },
        "id": "xy-edge__CustomAgent (DMwhm)-Bmybo{œdataTypeœ:œCustomAgent (DMwhm)œ,œidœ:œCustomAgent (DMwhm)-Bmyboœ,œnameœ:œresponseœ,œoutput_typesœ:[œMessageœ]}-ChatOutput-AbRpQ{œfieldNameœ:œinput_valueœ,œidœ:œChatOutput-AbRpQœ,œinputTypesœ:[œDataœ,œDataFrameœ,œMessageœ],œtypeœ:œotherœ}",
        "selected": false,
        "source": "CustomAgent (DMwhm)-Bmybo",
        "sourceHandle": "{œdataTypeœ:œCustomAgent (DMwhm)œ,œidœ:œCustomAgent (DMwhm)-Bmyboœ,œnameœ:œresponseœ,œoutput_typesœ:[œMessageœ]}",
        "target": "ChatOutput-AbRpQ",
        "targetHandle": "{œfieldNameœ:œinput_valueœ,œidœ:œChatOutput-AbRpQœ,œinputTypesœ:[œDataœ,œDataFrameœ,œMessageœ],œtypeœ:œotherœ}"
      },
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "CustomAgent (huvYE)",
            "id": "CustomAgent (huvYE)-DYRDM",
            "name": "response",
            "output_types": [
              "Message"
            ]
          },
          "targetHandle": {
            "fieldName": "input_value",
            "id": "CustomAgent (DMwhm)-Bmybo",
            "inputTypes": [
              "Message"
            ],
            "type": "str"
          }
        },
        "id": "xy-edge__CustomAgent (huvYE)-DYRDM{œdataTypeœ:œCustomAgent (huvYE)œ,œidœ:œCustomAgent (huvYE)-DYRDMœ,œnameœ:œresponseœ,œoutput_typesœ:[œMessageœ]}-CustomAgent (DMwhm)-Bmybo{œfieldNameœ:œinput_valueœ,œidœ:œCustomAgent (DMwhm)-Bmyboœ,œinputTypesœ:[œMessageœ],œtypeœ:œstrœ}",
        "selected": false,
        "source": "CustomAgent (huvYE)-DYRDM",
        "sourceHandle": "{œdataTypeœ:œCustomAgent (huvYE)œ,œidœ:œCustomAgent (huvYE)-DYRDMœ,œnameœ:œresponseœ,œoutput_typesœ:[œMessageœ]}",
        "target": "CustomAgent (DMwhm)-Bmybo",
        "targetHandle": "{œfieldNameœ:œinput_valueœ,œidœ:œCustomAgent (DMwhm)-Bmyboœ,œinputTypesœ:[œMessageœ],œtypeœ:œstrœ}"
      },
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "CustomAgent (yh5AE)",
            "id": "CustomAgent (yh5AE)-O2C2m",
            "name": "response",
            "output_types": [
              "Message"
            ]
          },
          "targetHandle": {
            "fieldName": "input_value",
            "id": "CustomAgent (huvYE)-DYRDM",
            "inputTypes": [
              "Message"
            ],
            "type": "str"
          }
        },
        "id": "xy-edge__CustomAgent (yh5AE)-O2C2m{œdataTypeœ:œCustomAgent (yh5AE)œ,œidœ:œCustomAgent (yh5AE)-O2C2mœ,œnameœ:œresponseœ,œoutput_typesœ:[œMessageœ]}-CustomAgent (huvYE)-DYRDM{œfieldNameœ:œinput_valueœ,œidœ:œCustomAgent (huvYE)-DYRDMœ,œinputTypesœ:[œMessageœ],œtypeœ:œstrœ}",
        "selected": false,
        "source": "CustomAgent (yh5AE)-O2C2m",
        "sourceHandle": "{œdataTypeœ:œCustomAgent (yh5AE)œ,œidœ:œCustomAgent (yh5AE)-O2C2mœ,œnameœ:œresponseœ,œoutput_typesœ:[œMessageœ]}",
        "target": "CustomAgent (huvYE)-DYRDM",
        "targetHandle": "{œfieldNameœ:œinput_valueœ,œidœ:œCustomAgent (huvYE)-DYRDMœ,œinputTypesœ:[œMessageœ],œtypeœ:œstrœ}"
      },
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "CustomAgent (4P411)",
            "id": "CustomAgent (4P411)-DtJnW",
            "name": "response",
            "output_types": [
              "Message"
            ]
          },
          "targetHandle": {
            "fieldName": "input_value",
            "id": "CustomAgent (yh5AE)-O2C2m",
            "inputTypes": [
              "Message"
            ],
            "type": "str"
          }
        },
        "id": "xy-edge__CustomAgent (4P411)-DtJnW{œdataTypeœ:œCustomAgent (4P411)œ,œidœ:œCustomAgent (4P411)-DtJnWœ,œnameœ:œresponseœ,œoutput_typesœ:[œMessageœ]}-CustomAgent (yh5AE)-O2C2m{œfieldNameœ:œinput_valueœ,œidœ:œCustomAgent (yh5AE)-O2C2mœ,œinputTypesœ:[œMessageœ],œtypeœ:œstrœ}",
        "selected": false,
        "source": "CustomAgent (4P411)-DtJnW",
        "sourceHandle": "{œdataTypeœ:œCustomAgent (4P411)œ,œidœ:œCustomAgent (4P411)-DtJnWœ,œnameœ:œresponseœ,œoutput_typesœ:[œMessageœ]}",
        "target": "CustomAgent (yh5AE)-O2C2m",
        "targetHandle": "{œfieldNameœ:œinput_valueœ,œidœ:œCustomAgent (yh5AE)-O2C2mœ,œinputTypesœ:[œMessageœ],œtypeœ:œstrœ}"
      },
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "CustomAgent (z1z0j)",
            "id": "CustomAgent (z1z0j)-SSxiC",
            "name": "response",
            "output_types": [
              "Message"
            ]
          },
          "targetHandle": {
            "fieldName": "input_value",
            "id": "CustomAgent (4P411)-DtJnW",
            "inputTypes": [
              "Message"
            ],
            "type": "str"
          }
        },
        "id": "xy-edge__CustomAgent (z1z0j)-SSxiC{œdataTypeœ:œCustomAgent (z1z0j)œ,œidœ:œCustomAgent (z1z0j)-SSxiCœ,œnameœ:œresponseœ,œoutput_typesœ:[œMessageœ]}-CustomAgent (4P411)-DtJnW{œfieldNameœ:œinput_valueœ,œidœ:œCustomAgent (4P411)-DtJnWœ,œinputTypesœ:[œMessageœ],œtypeœ:œstrœ}",
        "selected": false,
        "source": "CustomAgent (z1z0j)-SSxiC",
        "sourceHandle": "{œdataTypeœ:œCustomAgent (z1z0j)œ,œidœ:œCustomAgent (z1z0j)-SSxiCœ,œnameœ:œresponseœ,œoutput_typesœ:[œMessageœ]}",
        "target": "CustomAgent (4P411)-DtJnW",
        "targetHandle": "{œfieldNameœ:œinput_valueœ,œidœ:œCustomAgent (4P411)-DtJnWœ,œinputTypesœ:[œMessageœ],œtypeœ:œstrœ}"
      },
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "CustomAgent (480Vz)",
            "id": "CustomAgent (480Vz)-2gGag",
            "name": "response",
            "output_types": [
              "Message"
            ]
          },
          "targetHandle": {
            "fieldName": "input_value",
            "id": "CustomAgent (z1z0j)-SSxiC",
            "inputTypes": [
              "Message"
            ],
            "type": "str"
          }
        },
        "id": "xy-edge__CustomAgent (480Vz)-2gGag{œdataTypeœ:œCustomAgent (480Vz)œ,œidœ:œCustomAgent (480Vz)-2gGagœ,œnameœ:œresponseœ,œoutput_typesœ:[œMessageœ]}-CustomAgent (z1z0j)-SSxiC{œfieldNameœ:œinput_valueœ,œidœ:œCustomAgent (z1z0j)-SSxiCœ,œinputTypesœ:[œMessageœ],œtypeœ:œstrœ}",
        "selected": false,
        "source": "CustomAgent (480Vz)-2gGag",
        "sourceHandle": "{œdataTypeœ:œCustomAgent (480Vz)œ,œidœ:œCustomAgent (480Vz)-2gGagœ,œnameœ:œresponseœ,œoutput_typesœ:[œMessageœ]}",
        "target": "CustomAgent (z1z0j)-SSxiC",
        "targetHandle": "{œfieldNameœ:œinput_valueœ,œidœ:œCustomAgent (z1z0j)-SSxiCœ,œinputTypesœ:[œMessageœ],œtypeœ:œstrœ}"
      },
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "ChatInput",
            "id": "ChatInput-xJqpF",
            "name": "message",
            "output_types": [
              "Message"
            ]
          },
          "targetHandle": {
            "fieldName": "input_value",
            "id": "CustomAgent (480Vz)-2gGag",
            "inputTypes": [
              "Message"
            ],
            "type": "str"
          }
        },
        "id": "xy-edge__ChatInput-xJqpF{œdataTypeœ:œChatInputœ,œidœ:œChatInput-xJqpFœ,œnameœ:œmessageœ,œoutput_typesœ:[œMessageœ]}-CustomAgent (480Vz)-2gGag{œfieldNameœ:œinput_valueœ,œidœ:œCustomAgent (480Vz)-2gGagœ,œinputTypesœ:[œMessageœ],œtypeœ:œstrœ}",
        "selected": false,
        "source": "ChatInput-xJqpF",
        "sourceHandle": "{œdataTypeœ:œChatInputœ,œidœ:œChatInput-xJqpFœ,œnameœ:œmessageœ,œoutput_typesœ:[œMessageœ]}",
        "target": "CustomAgent (480Vz)-2gGag",
        "targetHandle": "{œfieldNameœ:œinput_valueœ,œidœ:œCustomAgent (480Vz)-2gGagœ,œinputTypesœ:[œMessageœ],œtypeœ:œstrœ}"
      },
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "OllamaModel (rLaRF)",
            "id": "OllamaModel (rLaRF)-BmD8c",
            "name": "model_output",
            "output_types": [
              "LanguageModel"
            ]
          },
          "targetHandle": {
            "fieldName": "llm",
            "id": "CustomAgent (480Vz)-2gGag",
            "inputTypes": [
              "LanguageModel"
            ],
            "type": "other"
          }
        },
        "id": "xy-edge__OllamaModel (rLaRF)-BmD8c{œdataTypeœ:œOllamaModel (rLaRF)œ,œidœ:œOllamaModel (rLaRF)-BmD8cœ,œnameœ:œmodel_outputœ,œoutput_typesœ:[œLanguageModelœ]}-CustomAgent (480Vz)-2gGag{œfieldNameœ:œllmœ,œidœ:œCustomAgent (480Vz)-2gGagœ,œinputTypesœ:[œLanguageModelœ],œtypeœ:œotherœ}",
        "selected": false,
        "source": "OllamaModel (rLaRF)-BmD8c",
        "sourceHandle": "{œdataTypeœ:œOllamaModel (rLaRF)œ,œidœ:œOllamaModel (rLaRF)-BmD8cœ,œnameœ:œmodel_outputœ,œoutput_typesœ:[œLanguageModelœ]}",
        "target": "CustomAgent (480Vz)-2gGag",
        "targetHandle": "{œfieldNameœ:œllmœ,œidœ:œCustomAgent (480Vz)-2gGagœ,œinputTypesœ:[œLanguageModelœ],œtypeœ:œotherœ}"
      },
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "OllamaModel (rLaRF)",
            "id": "OllamaModel (rLaRF)-BmD8c",
            "name": "model_output",
            "output_types": [
              "LanguageModel"
            ]
          },
          "targetHandle": {
            "fieldName": "llm",
            "id": "CustomAgent (z1z0j)-SSxiC",
            "inputTypes": [
              "LanguageModel"
            ],
            "type": "other"
          }
        },
        "id": "xy-edge__OllamaModel (rLaRF)-BmD8c{œdataTypeœ:œOllamaModel (rLaRF)œ,œidœ:œOllamaModel (rLaRF)-BmD8cœ,œnameœ:œmodel_outputœ,œoutput_typesœ:[œLanguageModelœ]}-CustomAgent (z1z0j)-SSxiC{œfieldNameœ:œllmœ,œidœ:œCustomAgent (z1z0j)-SSxiCœ,œinputTypesœ:[œLanguageModelœ],œtypeœ:œotherœ}",
        "selected": false,
        "source": "OllamaModel (rLaRF)-BmD8c",
        "sourceHandle": "{œdataTypeœ:œOllamaModel (rLaRF)œ,œidœ:œOllamaModel (rLaRF)-BmD8cœ,œnameœ:œmodel_outputœ,œoutput_typesœ:[œLanguageModelœ]}",
        "target": "CustomAgent (z1z0j)-SSxiC",
        "targetHandle": "{œfieldNameœ:œllmœ,œidœ:œCustomAgent (z1z0j)-SSxiCœ,œinputTypesœ:[œLanguageModelœ],œtypeœ:œotherœ}"
      },
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "OllamaModel (rLaRF)",
            "id": "OllamaModel (rLaRF)-BmD8c",
            "name": "model_output",
            "output_types": [
              "LanguageModel"
            ]
          },
          "targetHandle": {
            "fieldName": "llm",
            "id": "CustomAgent (4P411)-DtJnW",
            "inputTypes": [
              "LanguageModel"
            ],
            "type": "other"
          }
        },
        "id": "xy-edge__OllamaModel (rLaRF)-BmD8c{œdataTypeœ:œOllamaModel (rLaRF)œ,œidœ:œOllamaModel (rLaRF)-BmD8cœ,œnameœ:œmodel_outputœ,œoutput_typesœ:[œLanguageModelœ]}-CustomAgent (4P411)-DtJnW{œfieldNameœ:œllmœ,œidœ:œCustomAgent (4P411)-DtJnWœ,œinputTypesœ:[œLanguageModelœ],œtypeœ:œotherœ}",
        "selected": false,
        "source": "OllamaModel (rLaRF)-BmD8c",
        "sourceHandle": "{œdataTypeœ:œOllamaModel (rLaRF)œ,œidœ:œOllamaModel (rLaRF)-BmD8cœ,œnameœ:œmodel_outputœ,œoutput_typesœ:[œLanguageModelœ]}",
        "target": "CustomAgent (4P411)-DtJnW",
        "targetHandle": "{œfieldNameœ:œllmœ,œidœ:œCustomAgent (4P411)-DtJnWœ,œinputTypesœ:[œLanguageModelœ],œtypeœ:œotherœ}"
      },
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "OllamaModel (rLaRF)",
            "id": "OllamaModel (rLaRF)-BmD8c",
            "name": "model_output",
            "output_types": [
              "LanguageModel"
            ]
          },
          "targetHandle": {
            "fieldName": "llm",
            "id": "CustomAgent (yh5AE)-O2C2m",
            "inputTypes": [
              "LanguageModel"
            ],
            "type": "other"
          }
        },
        "id": "xy-edge__OllamaModel (rLaRF)-BmD8c{œdataTypeœ:œOllamaModel (rLaRF)œ,œidœ:œOllamaModel (rLaRF)-BmD8cœ,œnameœ:œmodel_outputœ,œoutput_typesœ:[œLanguageModelœ]}-CustomAgent (yh5AE)-O2C2m{œfieldNameœ:œllmœ,œidœ:œCustomAgent (yh5AE)-O2C2mœ,œinputTypesœ:[œLanguageModelœ],œtypeœ:œotherœ}",
        "selected": false,
        "source": "OllamaModel (rLaRF)-BmD8c",
        "sourceHandle": "{œdataTypeœ:œOllamaModel (rLaRF)œ,œidœ:œOllamaModel (rLaRF)-BmD8cœ,œnameœ:œmodel_outputœ,œoutput_typesœ:[œLanguageModelœ]}",
        "target": "CustomAgent (yh5AE)-O2C2m",
        "targetHandle": "{œfieldNameœ:œllmœ,œidœ:œCustomAgent (yh5AE)-O2C2mœ,œinputTypesœ:[œLanguageModelœ],œtypeœ:œotherœ}"
      },
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "OllamaModel (rLaRF)",
            "id": "OllamaModel (rLaRF)-BmD8c",
            "name": "model_output",
            "output_types": [
              "LanguageModel"
            ]
          },
          "targetHandle": {
            "fieldName": "llm",
            "id": "CustomAgent (huvYE)-DYRDM",
            "inputTypes": [
              "LanguageModel"
            ],
            "type": "other"
          }
        },
        "id": "xy-edge__OllamaModel (rLaRF)-BmD8c{œdataTypeœ:œOllamaModel (rLaRF)œ,œidœ:œOllamaModel (rLaRF)-BmD8cœ,œnameœ:œmodel_outputœ,œoutput_typesœ:[œLanguageModelœ]}-CustomAgent (huvYE)-DYRDM{œfieldNameœ:œllmœ,œidœ:œCustomAgent (huvYE)-DYRDMœ,œinputTypesœ:[œLanguageModelœ],œtypeœ:œotherœ}",
        "selected": false,
        "source": "OllamaModel (rLaRF)-BmD8c",
        "sourceHandle": "{œdataTypeœ:œOllamaModel (rLaRF)œ,œidœ:œOllamaModel (rLaRF)-BmD8cœ,œnameœ:œmodel_outputœ,œoutput_typesœ:[œLanguageModelœ]}",
        "target": "CustomAgent (huvYE)-DYRDM",
        "targetHandle": "{œfieldNameœ:œllmœ,œidœ:œCustomAgent (huvYE)-DYRDMœ,œinputTypesœ:[œLanguageModelœ],œtypeœ:œotherœ}"
      },
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "OllamaModel (rLaRF)",
            "id": "OllamaModel (rLaRF)-BmD8c",
            "name": "model_output",
            "output_types": [
              "LanguageModel"
            ]
          },
          "targetHandle": {
            "fieldName": "llm",
            "id": "CustomAgent (DMwhm)-Bmybo",
            "inputTypes": [
              "LanguageModel"
            ],
            "type": "other"
          }
        },
        "id": "xy-edge__OllamaModel (rLaRF)-BmD8c{œdataTypeœ:œOllamaModel (rLaRF)œ,œidœ:œOllamaModel (rLaRF)-BmD8cœ,œnameœ:œmodel_outputœ,œoutput_typesœ:[œLanguageModelœ]}-CustomAgent (DMwhm)-Bmybo{œfieldNameœ:œllmœ,œidœ:œCustomAgent (DMwhm)-Bmyboœ,œinputTypesœ:[œLanguageModelœ],œtypeœ:œotherœ}",
        "selected": false,
        "source": "OllamaModel (rLaRF)-BmD8c",
        "sourceHandle": "{œdataTypeœ:œOllamaModel (rLaRF)œ,œidœ:œOllamaModel (rLaRF)-BmD8cœ,œnameœ:œmodel_outputœ,œoutput_typesœ:[œLanguageModelœ]}",
        "target": "CustomAgent (DMwhm)-Bmybo",
        "targetHandle": "{œfieldNameœ:œllmœ,œidœ:œCustomAgent (DMwhm)-Bmyboœ,œinputTypesœ:[œLanguageModelœ],œtypeœ:œotherœ}"
      },
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "DuckDuckGoSearchComponent",
            "id": "DuckDuckGoSearchComponent-uiYpY",
            "name": "component_as_tool",
            "output_types": [
              "Tool"
            ]
          },
          "targetHandle": {
            "fieldName": "tools",
            "id": "CustomAgent (huvYE)-DYRDM",
            "inputTypes": [
              "Tool"
            ],
            "type": "other"
          }
        },
        "id": "xy-edge__DuckDuckGoSearchComponent-uiYpY{œdataTypeœ:œDuckDuckGoSearchComponentœ,œidœ:œDuckDuckGoSearchComponent-uiYpYœ,œnameœ:œcomponent_as_toolœ,œoutput_typesœ:[œToolœ]}-CustomAgent (huvYE)-DYRDM{œfieldNameœ:œtoolsœ,œidœ:œCustomAgent (huvYE)-DYRDMœ,œinputTypesœ:[œToolœ],œtypeœ:œotherœ}",
        "selected": false,
        "source": "DuckDuckGoSearchComponent-uiYpY",
        "sourceHandle": "{œdataTypeœ:œDuckDuckGoSearchComponentœ,œidœ:œDuckDuckGoSearchComponent-uiYpYœ,œnameœ:œcomponent_as_toolœ,œoutput_typesœ:[œToolœ]}",
        "target": "CustomAgent (huvYE)-DYRDM",
        "targetHandle": "{œfieldNameœ:œtoolsœ,œidœ:œCustomAgent (huvYE)-DYRDMœ,œinputTypesœ:[œToolœ],œtypeœ:œotherœ}"
      },
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "DuckDuckGoSearchComponent",
            "id": "DuckDuckGoSearchComponent-uiYpY",
            "name": "component_as_tool",
            "output_types": [
              "Tool"
            ]
          },
          "targetHandle": {
            "fieldName": "tools",
            "id": "CustomAgent (4P411)-DtJnW",
            "inputTypes": [
              "Tool"
            ],
            "type": "other"
          }
        },
        "id": "xy-edge__DuckDuckGoSearchComponent-uiYpY{œdataTypeœ:œDuckDuckGoSearchComponentœ,œidœ:œDuckDuckGoSearchComponent-uiYpYœ,œnameœ:œcomponent_as_toolœ,œoutput_typesœ:[œToolœ]}-CustomAgent (4P411)-DtJnW{œfieldNameœ:œtoolsœ,œidœ:œCustomAgent (4P411)-DtJnWœ,œinputTypesœ:[œToolœ],œtypeœ:œotherœ}",
        "selected": false,
        "source": "DuckDuckGoSearchComponent-uiYpY",
        "sourceHandle": "{œdataTypeœ:œDuckDuckGoSearchComponentœ,œidœ:œDuckDuckGoSearchComponent-uiYpYœ,œnameœ:œcomponent_as_toolœ,œoutput_typesœ:[œToolœ]}",
        "target": "CustomAgent (4P411)-DtJnW",
        "targetHandle": "{œfieldNameœ:œtoolsœ,œidœ:œCustomAgent (4P411)-DtJnWœ,œinputTypesœ:[œToolœ],œtypeœ:œotherœ}"
      },
      {
        "animated": false,
        "className": "",
        "data": {
          "sourceHandle": {
            "dataType": "DuckDuckGoSearchComponent",
            "id": "DuckDuckGoSearchComponent-uiYpY",
            "name": "component_as_tool",
            "output_types": [
              "Tool"
            ]
          },
          "targetHandle": {
            "fieldName": "tools",
            "id": "CustomAgent (yh5AE)-O2C2m",
            "inputTypes": [
              "Tool"
            ],
            "type": "other"
          }
        },
        "id": "xy-edge__DuckDuckGoSearchComponent-uiYpY{œdataTypeœ:œDuckDuckGoSearchComponentœ,œidœ:œDuckDuckGoSearchComponent-uiYpYœ,œnameœ:œcomponent_as_toolœ,œoutput_typesœ:[œToolœ]}-CustomAgent (yh5AE)-O2C2m{œfieldNameœ:œtoolsœ,œidœ:œCustomAgent (yh5AE)-O2C2mœ,œinputTypesœ:[œToolœ],œtypeœ:œotherœ}",
        "selected": false,
        "source": "DuckDuckGoSearchComponent-uiYpY",
        "sourceHandle": "{œdataTypeœ:œDuckDuckGoSearchComponentœ,œidœ:œDuckDuckGoSearchComponent-uiYpYœ,œnameœ:œcomponent_as_toolœ,œoutput_typesœ:[œToolœ]}",
        "target": "CustomAgent (yh5AE)-O2C2m",
        "targetHandle": "{œfieldNameœ:œtoolsœ,œidœ:œCustomAgent (yh5AE)-O2C2mœ,œinputTypesœ:[œToolœ],œtypeœ:œotherœ}"
      }
    ],
    "nodes": [
      {
        "data": {
          "id": "ChatInput-xJqpF",
          "node": {
            "base_classes": [
              "Message"
            ],
            "beta": false,
            "conditional_paths": [],
            "custom_fields": {},
            "description": "Get chat inputs from the Playground.",
            "display_name": "Chat Input",
            "documentation": "https://docs.langflow.org/chat-input-and-output",
            "edited": false,
            "field_order": [
              "input_value",
              "should_store_message",
              "sender",
              "sender_name",
              "session_id",
              "context_id",
              "files"
            ],
            "frozen": false,
            "icon": "MessagesSquare",
            "legacy": false,
            "lf_version": "1.7.1",
            "metadata": {
              "code_hash": "7a26c54d89ed",
              "dependencies": {
                "dependencies": [
                  {
                    "name": "lfx",
                    "version": "0.2.1"
                  }
                ],
                "total_dependencies": 1
              },
              "module": "lfx.components.input_output.chat.ChatInput"
            },
            "minimized": true,
            "output_types": [],
            "outputs": [
              {
                "allows_loop": false,
                "cache": true,
                "display_name": "Chat Message",
                "group_outputs": false,
                "method": "message_response",
                "name": "message",
                "selected": "Message",
                "tool_mode": true,
                "types": [
                  "Message"
                ],
                "value": "__UNDEFINED__"
              }
            ],
            "pinned": false,
            "template": {
              "_type": "Component",
              "code": {
                "advanced": true,
                "dynamic": true,
                "fileTypes": [],
                "file_path": "",
                "info": "",
                "list": false,
                "load_from_db": false,
                "multiline": true,
                "name": "code",
                "password": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "type": "code",
                "value": "from lfx.base.data.utils import IMG_FILE_TYPES, TEXT_FILE_TYPES\nfrom lfx.base.io.chat import ChatComponent\nfrom lfx.inputs.inputs import BoolInput\nfrom lfx.io import (\n    DropdownInput,\n    FileInput,\n    MessageTextInput,\n    MultilineInput,\n    Output,\n)\nfrom lfx.schema.message import Message\nfrom lfx.utils.constants import (\n    MESSAGE_SENDER_AI,\n    MESSAGE_SENDER_NAME_USER,\n    MESSAGE_SENDER_USER,\n)\n\n\nclass ChatInput(ChatComponent):\n    display_name = \"Chat Input\"\n    description = \"Get chat inputs from the Playground.\"\n    documentation: str = \"https://docs.langflow.org/chat-input-and-output\"\n    icon = \"MessagesSquare\"\n    name = \"ChatInput\"\n    minimized = True\n\n    inputs = [\n        MultilineInput(\n            name=\"input_value\",\n            display_name=\"Input Text\",\n            value=\"\",\n            info=\"Message to be passed as input.\",\n            input_types=[],\n        ),\n        BoolInput(\n            name=\"should_store_message\",\n            display_name=\"Store Messages\",\n            info=\"Store the message in the history.\",\n            value=True,\n            advanced=True,\n        ),\n        DropdownInput(\n            name=\"sender\",\n            display_name=\"Sender Type\",\n            options=[MESSAGE_SENDER_AI, MESSAGE_SENDER_USER],\n            value=MESSAGE_SENDER_USER,\n            info=\"Type of sender.\",\n            advanced=True,\n        ),\n        MessageTextInput(\n            name=\"sender_name\",\n            display_name=\"Sender Name\",\n            info=\"Name of the sender.\",\n            value=MESSAGE_SENDER_NAME_USER,\n            advanced=True,\n        ),\n        MessageTextInput(\n            name=\"session_id\",\n            display_name=\"Session ID\",\n            info=\"The session ID of the chat. If empty, the current session ID parameter will be used.\",\n            advanced=True,\n        ),\n        MessageTextInput(\n            name=\"context_id\",\n            display_name=\"Context ID\",\n            info=\"The context ID of the chat. Adds an extra layer to the local memory.\",\n            value=\"\",\n            advanced=True,\n        ),\n        FileInput(\n            name=\"files\",\n            display_name=\"Files\",\n            file_types=TEXT_FILE_TYPES + IMG_FILE_TYPES,\n            info=\"Files to be sent with the message.\",\n            advanced=True,\n            is_list=True,\n            temp_file=True,\n        ),\n    ]\n    outputs = [\n        Output(display_name=\"Chat Message\", name=\"message\", method=\"message_response\"),\n    ]\n\n    async def message_response(self) -> Message:\n        # Ensure files is a list and filter out empty/None values\n        files = self.files if self.files else []\n        if files and not isinstance(files, list):\n            files = [files]\n        # Filter out None/empty values\n        files = [f for f in files if f is not None and f != \"\"]\n\n        session_id = self.session_id or self.graph.session_id or \"\"\n        message = await Message.create(\n            text=self.input_value,\n            sender=self.sender,\n            sender_name=self.sender_name,\n            session_id=session_id,\n            context_id=self.context_id,\n            files=files,\n        )\n        if session_id and isinstance(message, Message) and self.should_store_message:\n            stored_message = await self.send_message(\n                message,\n            )\n            self.message.value = stored_message\n            message = stored_message\n\n        self.status = message\n        return message\n"
              },
              "context_id": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "Context ID",
                "dynamic": false,
                "info": "The context ID of the chat. Adds an extra layer to the local memory.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "context_id",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "files": {
                "_input_type": "FileInput",
                "advanced": true,
                "display_name": "Files",
                "dynamic": false,
                "fileTypes": [
                  "csv",
                  "json",
                  "pdf",
                  "txt",
                  "md",
                  "mdx",
                  "yaml",
                  "yml",
                  "xml",
                  "html",
                  "htm",
                  "docx",
                  "py",
                  "sh",
                  "sql",
                  "js",
                  "ts",
                  "tsx",
                  "jpg",
                  "jpeg",
                  "png",
                  "bmp",
                  "image"
                ],
                "file_path": "",
                "info": "Files to be sent with the message.",
                "list": true,
                "list_add_label": "Add More",
                "name": "files",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "temp_file": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "file",
                "value": ""
              },
              "input_value": {
                "_input_type": "MultilineInput",
                "advanced": false,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Input Text",
                "dynamic": false,
                "info": "Message to be passed as input.",
                "input_types": [],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "input_value",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "sender": {
                "_input_type": "DropdownInput",
                "advanced": true,
                "combobox": false,
                "dialog_inputs": {},
                "display_name": "Sender Type",
                "dynamic": false,
                "external_options": {},
                "info": "Type of sender.",
                "name": "sender",
                "options": [
                  "Machine",
                  "User"
                ],
                "options_metadata": [],
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "toggle": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "str",
                "value": "User"
              },
              "sender_name": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "Sender Name",
                "dynamic": false,
                "info": "Name of the sender.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "sender_name",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "User"
              },
              "session_id": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "Session ID",
                "dynamic": false,
                "info": "The session ID of the chat. If empty, the current session ID parameter will be used.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "session_id",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "should_store_message": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Store Messages",
                "dynamic": false,
                "info": "Store the message in the history.",
                "list": false,
                "list_add_label": "Add More",
                "name": "should_store_message",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              }
            },
            "tool_mode": false
          },
          "showNode": false,
          "type": "ChatInput"
        },
        "dragging": false,
        "id": "ChatInput-xJqpF",
        "measured": {
          "height": 48,
          "width": 192
        },
        "position": {
          "x": -148.1412518205819,
          "y": 60.19055302758788
        },
        "selected": false,
        "type": "genericNode"
      },
      {
        "data": {
          "id": "ChatOutput-AbRpQ",
          "node": {
            "base_classes": [
              "Message"
            ],
            "beta": false,
            "conditional_paths": [],
            "custom_fields": {},
            "description": "Display a chat message in the Playground.",
            "display_name": "Chat Output",
            "documentation": "https://docs.langflow.org/chat-input-and-output",
            "edited": false,
            "field_order": [
              "input_value",
              "should_store_message",
              "sender",
              "sender_name",
              "session_id",
              "context_id",
              "data_template",
              "clean_data"
            ],
            "frozen": false,
            "icon": "MessagesSquare",
            "legacy": false,
            "lf_version": "1.7.1",
            "metadata": {
              "code_hash": "8c87e536cca4",
              "dependencies": {
                "dependencies": [
                  {
                    "name": "orjson",
                    "version": "3.10.15"
                  },
                  {
                    "name": "fastapi",
                    "version": "0.128.0"
                  },
                  {
                    "name": "lfx",
                    "version": "0.2.1"
                  }
                ],
                "total_dependencies": 3
              },
              "module": "lfx.components.input_output.chat_output.ChatOutput"
            },
            "minimized": true,
            "output_types": [],
            "outputs": [
              {
                "allows_loop": false,
                "cache": true,
                "display_name": "Output Message",
                "group_outputs": false,
                "method": "message_response",
                "name": "message",
                "selected": "Message",
                "tool_mode": true,
                "types": [
                  "Message"
                ],
                "value": "__UNDEFINED__"
              }
            ],
            "pinned": false,
            "template": {
              "_type": "Component",
              "clean_data": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Basic Clean Data",
                "dynamic": false,
                "info": "Whether to clean data before converting to string.",
                "list": false,
                "list_add_label": "Add More",
                "name": "clean_data",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              },
              "code": {
                "advanced": true,
                "dynamic": true,
                "fileTypes": [],
                "file_path": "",
                "info": "",
                "list": false,
                "load_from_db": false,
                "multiline": true,
                "name": "code",
                "password": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "type": "code",
                "value": "from collections.abc import Generator\nfrom typing import Any\n\nimport orjson\nfrom fastapi.encoders import jsonable_encoder\n\nfrom lfx.base.io.chat import ChatComponent\nfrom lfx.helpers.data import safe_convert\nfrom lfx.inputs.inputs import BoolInput, DropdownInput, HandleInput, MessageTextInput\nfrom lfx.schema.data import Data\nfrom lfx.schema.dataframe import DataFrame\nfrom lfx.schema.message import Message\nfrom lfx.schema.properties import Source\nfrom lfx.template.field.base import Output\nfrom lfx.utils.constants import (\n    MESSAGE_SENDER_AI,\n    MESSAGE_SENDER_NAME_AI,\n    MESSAGE_SENDER_USER,\n)\n\n\nclass ChatOutput(ChatComponent):\n    display_name = \"Chat Output\"\n    description = \"Display a chat message in the Playground.\"\n    documentation: str = \"https://docs.langflow.org/chat-input-and-output\"\n    icon = \"MessagesSquare\"\n    name = \"ChatOutput\"\n    minimized = True\n\n    inputs = [\n        HandleInput(\n            name=\"input_value\",\n            display_name=\"Inputs\",\n            info=\"Message to be passed as output.\",\n            input_types=[\"Data\", \"DataFrame\", \"Message\"],\n            required=True,\n        ),\n        BoolInput(\n            name=\"should_store_message\",\n            display_name=\"Store Messages\",\n            info=\"Store the message in the history.\",\n            value=True,\n            advanced=True,\n        ),\n        DropdownInput(\n            name=\"sender\",\n            display_name=\"Sender Type\",\n            options=[MESSAGE_SENDER_AI, MESSAGE_SENDER_USER],\n            value=MESSAGE_SENDER_AI,\n            advanced=True,\n            info=\"Type of sender.\",\n        ),\n        MessageTextInput(\n            name=\"sender_name\",\n            display_name=\"Sender Name\",\n            info=\"Name of the sender.\",\n            value=MESSAGE_SENDER_NAME_AI,\n            advanced=True,\n        ),\n        MessageTextInput(\n            name=\"session_id\",\n            display_name=\"Session ID\",\n            info=\"The session ID of the chat. If empty, the current session ID parameter will be used.\",\n            advanced=True,\n        ),\n        MessageTextInput(\n            name=\"context_id\",\n            display_name=\"Context ID\",\n            info=\"The context ID of the chat. Adds an extra layer to the local memory.\",\n            value=\"\",\n            advanced=True,\n        ),\n        MessageTextInput(\n            name=\"data_template\",\n            display_name=\"Data Template\",\n            value=\"{text}\",\n            advanced=True,\n            info=\"Template to convert Data to Text. If left empty, it will be dynamically set to the Data's text key.\",\n        ),\n        BoolInput(\n            name=\"clean_data\",\n            display_name=\"Basic Clean Data\",\n            value=True,\n            advanced=True,\n            info=\"Whether to clean data before converting to string.\",\n        ),\n    ]\n    outputs = [\n        Output(\n            display_name=\"Output Message\",\n            name=\"message\",\n            method=\"message_response\",\n        ),\n    ]\n\n    def _build_source(self, id_: str | None, display_name: str | None, source: str | None) -> Source:\n        source_dict = {}\n        if id_:\n            source_dict[\"id\"] = id_\n        if display_name:\n            source_dict[\"display_name\"] = display_name\n        if source:\n            # Handle case where source is a ChatOpenAI object\n            if hasattr(source, \"model_name\"):\n                source_dict[\"source\"] = source.model_name\n            elif hasattr(source, \"model\"):\n                source_dict[\"source\"] = str(source.model)\n            else:\n                source_dict[\"source\"] = str(source)\n        return Source(**source_dict)\n\n    async def message_response(self) -> Message:\n        # First convert the input to string if needed\n        text = self.convert_to_string()\n\n        # Get source properties\n        source, _, display_name, source_id = self.get_properties_from_source_component()\n\n        # Create or use existing Message object\n        if isinstance(self.input_value, Message) and not self.is_connected_to_chat_input():\n            message = self.input_value\n            # Update message properties\n            message.text = text\n            # Preserve existing session_id from the incoming message if it exists\n            existing_session_id = message.session_id\n        else:\n            message = Message(text=text)\n            existing_session_id = None\n\n        # Set message properties\n        message.sender = self.sender\n        message.sender_name = self.sender_name\n        # Preserve session_id from incoming message, or use component/graph session_id\n        message.session_id = (\n            self.session_id or existing_session_id or (self.graph.session_id if hasattr(self, \"graph\") else None) or \"\"\n        )\n        message.context_id = self.context_id\n        message.flow_id = self.graph.flow_id if hasattr(self, \"graph\") else None\n        message.properties.source = self._build_source(source_id, display_name, source)\n\n        # Store message if needed\n        if message.session_id and self.should_store_message:\n            stored_message = await self.send_message(message)\n            self.message.value = stored_message\n            message = stored_message\n\n        self.status = message\n        return message\n\n    def _serialize_data(self, data: Data) -> str:\n        \"\"\"Serialize Data object to JSON string.\"\"\"\n        # Convert data.data to JSON-serializable format\n        serializable_data = jsonable_encoder(data.data)\n        # Serialize with orjson, enabling pretty printing with indentation\n        json_bytes = orjson.dumps(serializable_data, option=orjson.OPT_INDENT_2)\n        # Convert bytes to string and wrap in Markdown code blocks\n        return \"```json\\n\" + json_bytes.decode(\"utf-8\") + \"\\n```\"\n\n    def _validate_input(self) -> None:\n        \"\"\"Validate the input data and raise ValueError if invalid.\"\"\"\n        if self.input_value is None:\n            msg = \"Input data cannot be None\"\n            raise ValueError(msg)\n        if isinstance(self.input_value, list) and not all(\n            isinstance(item, Message | Data | DataFrame | str) for item in self.input_value\n        ):\n            invalid_types = [\n                type(item).__name__\n                for item in self.input_value\n                if not isinstance(item, Message | Data | DataFrame | str)\n            ]\n            msg = f\"Expected Data or DataFrame or Message or str, got {invalid_types}\"\n            raise TypeError(msg)\n        if not isinstance(\n            self.input_value,\n            Message | Data | DataFrame | str | list | Generator | type(None),\n        ):\n            type_name = type(self.input_value).__name__\n            msg = f\"Expected Data or DataFrame or Message or str, Generator or None, got {type_name}\"\n            raise TypeError(msg)\n\n    def convert_to_string(self) -> str | Generator[Any, None, None]:\n        \"\"\"Convert input data to string with proper error handling.\"\"\"\n        self._validate_input()\n        if isinstance(self.input_value, list):\n            clean_data: bool = getattr(self, \"clean_data\", False)\n            return \"\\n\".join([safe_convert(item, clean_data=clean_data) for item in self.input_value])\n        if isinstance(self.input_value, Generator):\n            return self.input_value\n        return safe_convert(self.input_value)\n"
              },
              "context_id": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "Context ID",
                "dynamic": false,
                "info": "The context ID of the chat. Adds an extra layer to the local memory.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "context_id",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "data_template": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "Data Template",
                "dynamic": false,
                "info": "Template to convert Data to Text. If left empty, it will be dynamically set to the Data's text key.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "data_template",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "{text}"
              },
              "input_value": {
                "_input_type": "HandleInput",
                "advanced": false,
                "display_name": "Inputs",
                "dynamic": false,
                "info": "Message to be passed as output.",
                "input_types": [
                  "Data",
                  "DataFrame",
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "name": "input_value",
                "override_skip": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "other",
                "value": ""
              },
              "sender": {
                "_input_type": "DropdownInput",
                "advanced": true,
                "combobox": false,
                "dialog_inputs": {},
                "display_name": "Sender Type",
                "dynamic": false,
                "external_options": {},
                "info": "Type of sender.",
                "name": "sender",
                "options": [
                  "Machine",
                  "User"
                ],
                "options_metadata": [],
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "toggle": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "str",
                "value": "Machine"
              },
              "sender_name": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "Sender Name",
                "dynamic": false,
                "info": "Name of the sender.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "sender_name",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "AI"
              },
              "session_id": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "Session ID",
                "dynamic": false,
                "info": "The session ID of the chat. If empty, the current session ID parameter will be used.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "session_id",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "should_store_message": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Store Messages",
                "dynamic": false,
                "info": "Store the message in the history.",
                "list": false,
                "list_add_label": "Add More",
                "name": "should_store_message",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              }
            },
            "tool_mode": false
          },
          "showNode": false,
          "type": "ChatOutput"
        },
        "dragging": false,
        "id": "ChatOutput-AbRpQ",
        "measured": {
          "height": 48,
          "width": 192
        },
        "position": {
          "x": 2262.118311775744,
          "y": 801.1354886561395
        },
        "selected": false,
        "type": "genericNode"
      },
      {
        "data": {
          "id": "OllamaModel (rLaRF)-BmD8c",
          "node": {
            "base_classes": [
              "Data",
              "DataFrame",
              "LanguageModel",
              "Message"
            ],
            "beta": false,
            "conditional_paths": [],
            "custom_fields": {},
            "description": "Generate text using Ollama Local LLMs.",
            "display_name": "Ollama (1)",
            "documentation": "",
            "edited": false,
            "field_order": [
              "base_url",
              "model_name",
              "api_key",
              "temperature",
              "format",
              "metadata",
              "mirostat",
              "mirostat_eta",
              "mirostat_tau",
              "num_ctx",
              "num_gpu",
              "num_thread",
              "repeat_last_n",
              "repeat_penalty",
              "tfs_z",
              "timeout",
              "top_k",
              "top_p",
              "enable_verbose_output",
              "tags",
              "stop_tokens",
              "system",
              "tool_model_enabled",
              "template",
              "enable_structured_output",
              "input_value",
              "system_message",
              "stream"
            ],
            "frozen": false,
            "icon": "Ollama",
            "last_updated": "2026-01-14T15:52:33.114Z",
            "legacy": false,
            "lf_version": "1.7.1",
            "metadata": {
              "code_hash": "12e5c1954fe1",
              "dependencies": {
                "dependencies": [
                  {
                    "name": "httpx",
                    "version": "0.28.1"
                  },
                  {
                    "name": "langchain_ollama",
                    "version": "0.3.10"
                  },
                  {
                    "name": "lfx",
                    "version": "0.2.1"
                  }
                ],
                "total_dependencies": 3
              },
              "keywords": [
                "model",
                "llm",
                "language model",
                "large language model"
              ],
              "module": "lfx.components.ollama.ollama.ChatOllamaComponent"
            },
            "minimized": false,
            "official": false,
            "output_types": [],
            "outputs": [
              {
                "allows_loop": false,
                "cache": true,
                "display_name": "Text",
                "group_outputs": false,
                "loop_types": null,
                "method": "text_response",
                "name": "text_output",
                "options": null,
                "required_inputs": null,
                "selected": "Message",
                "tool_mode": true,
                "types": [
                  "Message"
                ],
                "value": "__UNDEFINED__"
              },
              {
                "allows_loop": false,
                "cache": true,
                "display_name": "Language Model",
                "group_outputs": false,
                "loop_types": null,
                "method": "build_model",
                "name": "model_output",
                "options": null,
                "required_inputs": null,
                "selected": "LanguageModel",
                "tool_mode": true,
                "types": [
                  "LanguageModel"
                ],
                "value": "__UNDEFINED__"
              },
              {
                "allows_loop": false,
                "cache": true,
                "display_name": "Data",
                "group_outputs": false,
                "loop_types": null,
                "method": "build_data_output",
                "name": "data_output",
                "options": null,
                "required_inputs": null,
                "selected": "Data",
                "tool_mode": true,
                "types": [
                  "Data"
                ],
                "value": "__UNDEFINED__"
              },
              {
                "allows_loop": false,
                "cache": true,
                "display_name": "DataFrame",
                "group_outputs": false,
                "loop_types": null,
                "method": "build_dataframe_output",
                "name": "dataframe_output",
                "options": null,
                "required_inputs": null,
                "selected": "DataFrame",
                "tool_mode": true,
                "types": [
                  "DataFrame"
                ],
                "value": "__UNDEFINED__"
              }
            ],
            "pinned": false,
            "template": {
              "_frontend_node_flow_id": {
                "value": "497837db-2331-441c-bcdd-88e652728e3e"
              },
              "_frontend_node_folder_id": {
                "value": "5a69c093-1586-47bb-8a87-3fbd6c0b29f6"
              },
              "_type": "Component",
              "api_key": {
                "_input_type": "SecretStrInput",
                "advanced": false,
                "display_name": "Ollama API Key",
                "dynamic": false,
                "info": "Your Ollama API key.",
                "input_types": [],
                "load_from_db": false,
                "name": "api_key",
                "override_skip": false,
                "password": true,
                "placeholder": "",
                "real_time_refresh": true,
                "required": false,
                "show": true,
                "title_case": false,
                "track_in_telemetry": false,
                "type": "str",
                "value": "1c14176613af4450bea550e98ec1c238.Ve1DBD3yTCwvSRpYZjPuG4Qo"
              },
              "base_url": {
                "_input_type": "MessageTextInput",
                "advanced": false,
                "display_name": "Ollama API URL",
                "dynamic": false,
                "info": "Endpoint of the Ollama API. Defaults to http://localhost:11434.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "base_url",
                "override_skip": false,
                "placeholder": "",
                "real_time_refresh": true,
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "http://localhost:11434"
              },
              "code": {
                "advanced": true,
                "dynamic": true,
                "fileTypes": [],
                "file_path": "",
                "info": "",
                "list": false,
                "load_from_db": false,
                "multiline": true,
                "name": "code",
                "password": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "type": "code",
                "value": "import asyncio\nimport json\nfrom contextlib import suppress\nfrom typing import Any\nfrom urllib.parse import urljoin\n\nimport httpx\nfrom langchain_ollama import ChatOllama\n\nfrom lfx.base.models.model import LCModelComponent\nfrom lfx.field_typing import LanguageModel\nfrom lfx.field_typing.range_spec import RangeSpec\nfrom lfx.helpers.base_model import build_model_from_schema\nfrom lfx.io import (\n    BoolInput,\n    DictInput,\n    DropdownInput,\n    FloatInput,\n    IntInput,\n    MessageTextInput,\n    Output,\n    SecretStrInput,\n    SliderInput,\n    TableInput,\n)\nfrom lfx.log.logger import logger\nfrom lfx.schema.data import Data\nfrom lfx.schema.dataframe import DataFrame\nfrom lfx.schema.table import EditMode\nfrom lfx.utils.util import transform_localhost_url\n\nHTTP_STATUS_OK = 200\nTABLE_ROW_PLACEHOLDER = {\"name\": \"field\", \"description\": \"description of field\", \"type\": \"str\", \"multiple\": \"False\"}\n\n\nclass ChatOllamaComponent(LCModelComponent):\n    display_name = \"Ollama\"\n    description = \"Generate text using Ollama Local LLMs.\"\n    icon = \"Ollama\"\n    name = \"OllamaModel\"\n\n    # Define constants for JSON keys\n    JSON_MODELS_KEY = \"models\"\n    JSON_NAME_KEY = \"name\"\n    JSON_CAPABILITIES_KEY = \"capabilities\"\n    DESIRED_CAPABILITY = \"completion\"\n    TOOL_CALLING_CAPABILITY = \"tools\"\n\n    # Define the table schema for the format input\n    TABLE_SCHEMA = [\n        {\n            \"name\": \"name\",\n            \"display_name\": \"Name\",\n            \"type\": \"str\",\n            \"description\": \"Specify the name of the output field.\",\n            \"default\": \"field\",\n            \"edit_mode\": EditMode.INLINE,\n        },\n        {\n            \"name\": \"description\",\n            \"display_name\": \"Description\",\n            \"type\": \"str\",\n            \"description\": \"Describe the purpose of the output field.\",\n            \"default\": \"description of field\",\n            \"edit_mode\": EditMode.POPOVER,\n        },\n        {\n            \"name\": \"type\",\n            \"display_name\": \"Type\",\n            \"type\": \"str\",\n            \"edit_mode\": EditMode.INLINE,\n            \"description\": (\"Indicate the data type of the output field (e.g., str, int, float, bool, dict).\"),\n            \"options\": [\"str\", \"int\", \"float\", \"bool\", \"dict\"],\n            \"default\": \"str\",\n        },\n        {\n            \"name\": \"multiple\",\n            \"display_name\": \"As List\",\n            \"type\": \"boolean\",\n            \"description\": \"Set to True if this output field should be a list of the specified type.\",\n            \"edit_mode\": EditMode.INLINE,\n            \"options\": [\"True\", \"False\"],\n            \"default\": \"False\",\n        },\n    ]\n    default_table_row = {row[\"name\"]: row.get(\"default\", None) for row in TABLE_SCHEMA}\n    default_table_row_schema = build_model_from_schema([default_table_row]).model_json_schema()\n\n    inputs = [\n        MessageTextInput(\n            name=\"base_url\",\n            display_name=\"Ollama API URL\",\n            info=\"Endpoint of the Ollama API. Defaults to http://localhost:11434.\",\n            value=\"http://localhost:11434\",\n            real_time_refresh=True,\n        ),\n        DropdownInput(\n            name=\"model_name\",\n            display_name=\"Model Name\",\n            options=[],\n            info=\"Refer to https://ollama.com/library for more models.\",\n            refresh_button=True,\n            real_time_refresh=True,\n            required=True,\n        ),\n        SecretStrInput(\n            name=\"api_key\",\n            display_name=\"Ollama API Key\",\n            info=\"Your Ollama API key.\",\n            value=None,\n            required=False,\n            real_time_refresh=True,\n            advanced=True,\n        ),\n        SliderInput(\n            name=\"temperature\",\n            display_name=\"Temperature\",\n            value=0.1,\n            range_spec=RangeSpec(min=0, max=1, step=0.01),\n            advanced=True,\n        ),\n        TableInput(\n            name=\"format\",\n            display_name=\"Format\",\n            info=\"Specify the format of the output.\",\n            table_schema=TABLE_SCHEMA,\n            value=default_table_row,\n            show=False,\n        ),\n        DictInput(name=\"metadata\", display_name=\"Metadata\", info=\"Metadata to add to the run trace.\", advanced=True),\n        DropdownInput(\n            name=\"mirostat\",\n            display_name=\"Mirostat\",\n            options=[\"Disabled\", \"Mirostat\", \"Mirostat 2.0\"],\n            info=\"Enable/disable Mirostat sampling for controlling perplexity.\",\n            value=\"Disabled\",\n            advanced=True,\n            real_time_refresh=True,\n        ),\n        FloatInput(\n            name=\"mirostat_eta\",\n            display_name=\"Mirostat Eta\",\n            info=\"Learning rate for Mirostat algorithm. (Default: 0.1)\",\n            advanced=True,\n        ),\n        FloatInput(\n            name=\"mirostat_tau\",\n            display_name=\"Mirostat Tau\",\n            info=\"Controls the balance between coherence and diversity of the output. (Default: 5.0)\",\n            advanced=True,\n        ),\n        IntInput(\n            name=\"num_ctx\",\n            display_name=\"Context Window Size\",\n            info=\"Size of the context window for generating tokens. (Default: 2048)\",\n            advanced=True,\n        ),\n        IntInput(\n            name=\"num_gpu\",\n            display_name=\"Number of GPUs\",\n            info=\"Number of GPUs to use for computation. (Default: 1 on macOS, 0 to disable)\",\n            advanced=True,\n        ),\n        IntInput(\n            name=\"num_thread\",\n            display_name=\"Number of Threads\",\n            info=\"Number of threads to use during computation. (Default: detected for optimal performance)\",\n            advanced=True,\n        ),\n        IntInput(\n            name=\"repeat_last_n\",\n            display_name=\"Repeat Last N\",\n            info=\"How far back the model looks to prevent repetition. (Default: 64, 0 = disabled, -1 = num_ctx)\",\n            advanced=True,\n        ),\n        FloatInput(\n            name=\"repeat_penalty\",\n            display_name=\"Repeat Penalty\",\n            info=\"Penalty for repetitions in generated text. (Default: 1.1)\",\n            advanced=True,\n        ),\n        FloatInput(name=\"tfs_z\", display_name=\"TFS Z\", info=\"Tail free sampling value. (Default: 1)\", advanced=True),\n        IntInput(name=\"timeout\", display_name=\"Timeout\", info=\"Timeout for the request stream.\", advanced=True),\n        IntInput(\n            name=\"top_k\", display_name=\"Top K\", info=\"Limits token selection to top K. (Default: 40)\", advanced=True\n        ),\n        FloatInput(name=\"top_p\", display_name=\"Top P\", info=\"Works together with top-k. (Default: 0.9)\", advanced=True),\n        BoolInput(\n            name=\"enable_verbose_output\",\n            display_name=\"Ollama Verbose Output\",\n            info=\"Whether to print out response text.\",\n            advanced=True,\n        ),\n        MessageTextInput(\n            name=\"tags\",\n            display_name=\"Tags\",\n            info=\"Comma-separated list of tags to add to the run trace.\",\n            advanced=True,\n        ),\n        MessageTextInput(\n            name=\"stop_tokens\",\n            display_name=\"Stop Tokens\",\n            info=\"Comma-separated list of tokens to signal the model to stop generating text.\",\n            advanced=True,\n        ),\n        MessageTextInput(\n            name=\"system\", display_name=\"System\", info=\"System to use for generating text.\", advanced=True\n        ),\n        BoolInput(\n            name=\"tool_model_enabled\",\n            display_name=\"Tool Model Enabled\",\n            info=\"Whether to enable tool calling in the model.\",\n            value=True,\n            real_time_refresh=True,\n        ),\n        MessageTextInput(\n            name=\"template\", display_name=\"Template\", info=\"Template to use for generating text.\", advanced=True\n        ),\n        BoolInput(\n            name=\"enable_structured_output\",\n            display_name=\"Enable Structured Output\",\n            info=\"Whether to enable structured output in the model.\",\n            value=False,\n            advanced=False,\n            real_time_refresh=True,\n        ),\n        *LCModelComponent.get_base_inputs(),\n    ]\n\n    outputs = [\n        Output(display_name=\"Text\", name=\"text_output\", method=\"text_response\"),\n        Output(display_name=\"Language Model\", name=\"model_output\", method=\"build_model\"),\n        Output(display_name=\"Data\", name=\"data_output\", method=\"build_data_output\"),\n        Output(display_name=\"DataFrame\", name=\"dataframe_output\", method=\"build_dataframe_output\"),\n    ]\n\n    def build_model(self) -> LanguageModel:  # type: ignore[type-var]\n        # Mapping mirostat settings to their corresponding values\n        mirostat_options = {\"Mirostat\": 1, \"Mirostat 2.0\": 2}\n\n        # Default to None for 'Disabled'\n        mirostat_value = mirostat_options.get(self.mirostat, None)\n\n        # Set mirostat_eta and mirostat_tau to None if mirostat is disabled\n        if mirostat_value is None:\n            mirostat_eta = None\n            mirostat_tau = None\n        else:\n            mirostat_eta = self.mirostat_eta\n            mirostat_tau = self.mirostat_tau\n\n        transformed_base_url = transform_localhost_url(self.base_url)\n\n        # Check if URL contains /v1 suffix (OpenAI-compatible mode)\n        if transformed_base_url and transformed_base_url.rstrip(\"/\").endswith(\"/v1\"):\n            # Strip /v1 suffix and log warning\n            transformed_base_url = transformed_base_url.rstrip(\"/\").removesuffix(\"/v1\")\n            logger.warning(\n                \"Detected '/v1' suffix in base URL. The Ollama component uses the native Ollama API, \"\n                \"not the OpenAI-compatible API. The '/v1' suffix has been automatically removed. \"\n                \"If you want to use the OpenAI-compatible API, please use the OpenAI component instead. \"\n                \"Learn more at https://docs.ollama.com/openai#openai-compatibility\"\n            )\n\n        try:\n            output_format = self._parse_format_field(self.format) if self.enable_structured_output else None\n        except Exception as e:\n            msg = f\"Failed to parse the format field: {e}\"\n            raise ValueError(msg) from e\n\n        # Mapping system settings to their corresponding values\n        llm_params = {\n            \"base_url\": transformed_base_url,\n            \"model\": self.model_name,\n            \"mirostat\": mirostat_value,\n            \"format\": output_format or None,\n            \"metadata\": self.metadata,\n            \"tags\": self.tags.split(\",\") if self.tags else None,\n            \"mirostat_eta\": mirostat_eta,\n            \"mirostat_tau\": mirostat_tau,\n            \"num_ctx\": self.num_ctx or None,\n            \"num_gpu\": self.num_gpu or None,\n            \"num_thread\": self.num_thread or None,\n            \"repeat_last_n\": self.repeat_last_n or None,\n            \"repeat_penalty\": self.repeat_penalty or None,\n            \"temperature\": self.temperature or None,\n            \"stop\": self.stop_tokens.split(\",\") if self.stop_tokens else None,\n            \"system\": self.system,\n            \"tfs_z\": self.tfs_z or None,\n            \"timeout\": self.timeout or None,\n            \"top_k\": self.top_k or None,\n            \"top_p\": self.top_p or None,\n            \"verbose\": self.enable_verbose_output or False,\n            \"template\": self.template,\n        }\n        headers = self.headers\n        if headers is not None:\n            llm_params[\"client_kwargs\"] = {\"headers\": headers}\n\n        # Remove parameters with None values\n        llm_params = {k: v for k, v in llm_params.items() if v is not None}\n\n        try:\n            output = ChatOllama(**llm_params)\n        except Exception as e:\n            msg = (\n                \"Unable to connect to the Ollama API. \"\n                \"Please verify the base URL, ensure the relevant Ollama model is pulled, and try again.\"\n            )\n            raise ValueError(msg) from e\n\n        return output\n\n    async def is_valid_ollama_url(self, url: str) -> bool:\n        try:\n            async with httpx.AsyncClient() as client:\n                url = transform_localhost_url(url)\n                if not url:\n                    return False\n                # Strip /v1 suffix if present, as Ollama API endpoints are at root level\n                url = url.rstrip(\"/\").removesuffix(\"/v1\")\n                if not url.endswith(\"/\"):\n                    url = url + \"/\"\n                return (\n                    await client.get(url=urljoin(url, \"api/tags\"), headers=self.headers)\n                ).status_code == HTTP_STATUS_OK\n        except httpx.RequestError:\n            return False\n\n    async def update_build_config(self, build_config: dict, field_value: Any, field_name: str | None = None):\n        if field_name == \"enable_structured_output\":  # bind enable_structured_output boolean to format show value\n            build_config[\"format\"][\"show\"] = field_value\n\n        if field_name == \"mirostat\":\n            if field_value == \"Disabled\":\n                build_config[\"mirostat_eta\"][\"advanced\"] = True\n                build_config[\"mirostat_tau\"][\"advanced\"] = True\n                build_config[\"mirostat_eta\"][\"value\"] = None\n                build_config[\"mirostat_tau\"][\"value\"] = None\n\n            else:\n                build_config[\"mirostat_eta\"][\"advanced\"] = False\n                build_config[\"mirostat_tau\"][\"advanced\"] = False\n\n                if field_value == \"Mirostat 2.0\":\n                    build_config[\"mirostat_eta\"][\"value\"] = 0.2\n                    build_config[\"mirostat_tau\"][\"value\"] = 10\n                else:\n                    build_config[\"mirostat_eta\"][\"value\"] = 0.1\n                    build_config[\"mirostat_tau\"][\"value\"] = 5\n\n        if field_name in {\"model_name\", \"base_url\", \"tool_model_enabled\"}:\n            # Use field_value if base_url is being updated, otherwise use self.base_url\n            base_url_to_check = field_value if field_name == \"base_url\" else self.base_url\n            # Fallback to self.base_url if field_value is None or empty\n            if not base_url_to_check and field_name == \"base_url\":\n                base_url_to_check = self.base_url\n            logger.warning(f\"Fetching Ollama models from updated URL: {base_url_to_check}\")\n\n            if base_url_to_check and await self.is_valid_ollama_url(base_url_to_check):\n                tool_model_enabled = build_config[\"tool_model_enabled\"].get(\"value\", False) or self.tool_model_enabled\n                build_config[\"model_name\"][\"options\"] = await self.get_models(\n                    base_url_to_check, tool_model_enabled=tool_model_enabled\n                )\n            else:\n                build_config[\"model_name\"][\"options\"] = []\n        if field_name == \"keep_alive_flag\":\n            if field_value == \"Keep\":\n                build_config[\"keep_alive\"][\"value\"] = \"-1\"\n                build_config[\"keep_alive\"][\"advanced\"] = True\n            elif field_value == \"Immediately\":\n                build_config[\"keep_alive\"][\"value\"] = \"0\"\n                build_config[\"keep_alive\"][\"advanced\"] = True\n            else:\n                build_config[\"keep_alive\"][\"advanced\"] = False\n\n        return build_config\n\n    async def get_models(self, base_url_value: str, *, tool_model_enabled: bool | None = None) -> list[str]:\n        \"\"\"Fetches a list of models from the Ollama API that do not have the \"embedding\" capability.\n\n        Args:\n            base_url_value (str): The base URL of the Ollama API.\n            tool_model_enabled (bool | None, optional): If True, filters the models further to include\n                only those that support tool calling. Defaults to None.\n\n        Returns:\n            list[str]: A list of model names that do not have the \"embedding\" capability. If\n                `tool_model_enabled` is True, only models supporting tool calling are included.\n\n        Raises:\n            ValueError: If there is an issue with the API request or response, or if the model\n                names cannot be retrieved.\n        \"\"\"\n        try:\n            # Strip /v1 suffix if present, as Ollama API endpoints are at root level\n            base_url = base_url_value.rstrip(\"/\").removesuffix(\"/v1\")\n            if not base_url.endswith(\"/\"):\n                base_url = base_url + \"/\"\n            base_url = transform_localhost_url(base_url)\n\n            # Ollama REST API to return models\n            tags_url = urljoin(base_url, \"api/tags\")\n\n            # Ollama REST API to return model capabilities\n            show_url = urljoin(base_url, \"api/show\")\n\n            async with httpx.AsyncClient() as client:\n                headers = self.headers\n                # Fetch available models\n                tags_response = await client.get(url=tags_url, headers=headers)\n                tags_response.raise_for_status()\n                models = tags_response.json()\n                if asyncio.iscoroutine(models):\n                    models = await models\n                await logger.adebug(f\"Available models: {models}\")\n\n                # Filter models that are NOT embedding models\n                model_ids = []\n                for model in models[self.JSON_MODELS_KEY]:\n                    model_name = model[self.JSON_NAME_KEY]\n                    await logger.adebug(f\"Checking model: {model_name}\")\n\n                    payload = {\"model\": model_name}\n                    show_response = await client.post(url=show_url, json=payload, headers=headers)\n                    show_response.raise_for_status()\n                    json_data = show_response.json()\n                    if asyncio.iscoroutine(json_data):\n                        json_data = await json_data\n\n                    capabilities = json_data.get(self.JSON_CAPABILITIES_KEY, [])\n                    await logger.adebug(f\"Model: {model_name}, Capabilities: {capabilities}\")\n\n                    if self.DESIRED_CAPABILITY in capabilities and (\n                        not tool_model_enabled or self.TOOL_CALLING_CAPABILITY in capabilities\n                    ):\n                        model_ids.append(model_name)\n\n        except (httpx.RequestError, ValueError) as e:\n            msg = \"Could not get model names from Ollama.\"\n            raise ValueError(msg) from e\n\n        return model_ids\n\n    def _parse_format_field(self, format_value: Any) -> Any:\n        \"\"\"Parse the format field to handle both string and dict inputs.\n\n        The format field can be:\n        - A simple string like \"json\" (backward compatibility)\n        - A JSON string from NestedDictInput that needs parsing\n        - A dict/JSON schema (already parsed)\n        - None or empty\n\n        Args:\n            format_value: The raw format value from the input field\n\n        Returns:\n            Parsed format value as string, dict, or None\n        \"\"\"\n        if not format_value:\n            return None\n\n        schema = format_value\n        if isinstance(format_value, list):\n            schema = build_model_from_schema(format_value).model_json_schema()\n            if schema == self.default_table_row_schema:\n                return None  # the rows are generic placeholder rows\n        elif isinstance(format_value, str):  # parse as json if string\n            with suppress(json.JSONDecodeError):  # e.g., literal \"json\" is valid for format field\n                schema = json.loads(format_value)\n\n        return schema or None\n\n    async def _parse_json_response(self) -> Any:\n        \"\"\"Parse the JSON response from the model.\n\n        This method gets the text response and attempts to parse it as JSON.\n        Works with models that have format='json' or a JSON schema set.\n\n        Returns:\n            Parsed JSON (dict, list, or primitive type)\n\n        Raises:\n            ValueError: If the response is not valid JSON\n        \"\"\"\n        message = await self.text_response()\n        text = message.text if hasattr(message, \"text\") else str(message)\n\n        if not text:\n            msg = \"No response from model\"\n            raise ValueError(msg)\n\n        try:\n            return json.loads(text)\n        except json.JSONDecodeError as e:\n            msg = f\"Invalid JSON response. Ensure model supports JSON output. Error: {e}\"\n            raise ValueError(msg) from e\n\n    async def build_data_output(self) -> Data:\n        \"\"\"Build a Data output from the model's JSON response.\n\n        Returns:\n            Data: A Data object containing the parsed JSON response\n        \"\"\"\n        parsed = await self._parse_json_response()\n\n        # If the response is already a dict, wrap it in Data\n        if isinstance(parsed, dict):\n            return Data(data=parsed)\n\n        # If it's a list, wrap in a results container\n        if isinstance(parsed, list):\n            if len(parsed) == 1:\n                return Data(data=parsed[0])\n            return Data(data={\"results\": parsed})\n\n        # For primitive types, wrap in a value container\n        return Data(data={\"value\": parsed})\n\n    async def build_dataframe_output(self) -> DataFrame:\n        \"\"\"Build a DataFrame output from the model's JSON response.\n\n        Returns:\n            DataFrame: A DataFrame containing the parsed JSON response\n\n        Raises:\n            ValueError: If the response cannot be converted to a DataFrame\n        \"\"\"\n        parsed = await self._parse_json_response()\n\n        # If it's a list of dicts, convert directly to DataFrame\n        if isinstance(parsed, list):\n            if not parsed:\n                return DataFrame()\n            # Ensure all items are dicts for proper DataFrame conversion\n            if all(isinstance(item, dict) for item in parsed):\n                return DataFrame(parsed)\n            msg = \"List items must be dictionaries to convert to DataFrame\"\n            raise ValueError(msg)\n\n        # If it's a single dict, wrap in a list to create a single-row DataFrame\n        if isinstance(parsed, dict):\n            return DataFrame([parsed])\n\n        # For primitive types, create a single-column DataFrame\n        return DataFrame([{\"value\": parsed}])\n\n    @property\n    def headers(self) -> dict[str, str] | None:\n        \"\"\"Get the headers for the Ollama API.\"\"\"\n        if self.api_key and self.api_key.strip():\n            return {\"Authorization\": f\"Bearer {self.api_key}\"}\n        return None\n"
              },
              "enable_structured_output": {
                "_input_type": "BoolInput",
                "advanced": false,
                "display_name": "Enable Structured Output",
                "dynamic": false,
                "info": "Whether to enable structured output in the model.",
                "list": false,
                "list_add_label": "Add More",
                "name": "enable_structured_output",
                "override_skip": false,
                "placeholder": "",
                "real_time_refresh": true,
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": false
              },
              "enable_verbose_output": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Ollama Verbose Output",
                "dynamic": false,
                "info": "Whether to print out response text.",
                "list": false,
                "list_add_label": "Add More",
                "name": "enable_verbose_output",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": false
              },
              "format": {
                "_input_type": "TableInput",
                "advanced": false,
                "display_name": "Format",
                "dynamic": false,
                "info": "Specify the format of the output.",
                "is_list": true,
                "list_add_label": "Add More",
                "name": "format",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": false,
                "table_icon": "Table",
                "table_schema": [
                  {
                    "default": "field",
                    "description": "Specify the name of the output field.",
                    "display_name": "Name",
                    "edit_mode": "inline",
                    "name": "name",
                    "type": "str"
                  },
                  {
                    "default": "description of field",
                    "description": "Describe the purpose of the output field.",
                    "display_name": "Description",
                    "edit_mode": "popover",
                    "name": "description",
                    "type": "str"
                  },
                  {
                    "default": "str",
                    "description": "Indicate the data type of the output field (e.g., str, int, float, bool, dict).",
                    "display_name": "Type",
                    "edit_mode": "inline",
                    "name": "type",
                    "options": [
                      "str",
                      "int",
                      "float",
                      "bool",
                      "dict"
                    ],
                    "type": "str"
                  },
                  {
                    "default": "False",
                    "description": "Set to True if this output field should be a list of the specified type.",
                    "display_name": "As List",
                    "edit_mode": "inline",
                    "name": "multiple",
                    "options": [
                      "True",
                      "False"
                    ],
                    "type": "boolean"
                  }
                ],
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "trigger_icon": "Table",
                "trigger_text": "Open table",
                "type": "table",
                "value": [
                  {
                    "description": "description of field",
                    "multiple": "False",
                    "name": "field",
                    "type": "str"
                  }
                ]
              },
              "input_value": {
                "_input_type": "MessageInput",
                "advanced": false,
                "display_name": "Input",
                "dynamic": false,
                "info": "",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "input_value",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "is_refresh": false,
              "metadata": {
                "_input_type": "DictInput",
                "advanced": true,
                "display_name": "Metadata",
                "dynamic": false,
                "info": "Metadata to add to the run trace.",
                "list": false,
                "list_add_label": "Add More",
                "name": "metadata",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "track_in_telemetry": false,
                "type": "dict",
                "value": {}
              },
              "mirostat": {
                "_input_type": "DropdownInput",
                "advanced": true,
                "combobox": false,
                "dialog_inputs": {},
                "display_name": "Mirostat",
                "dynamic": false,
                "external_options": {},
                "info": "Enable/disable Mirostat sampling for controlling perplexity.",
                "name": "mirostat",
                "options": [
                  "Disabled",
                  "Mirostat",
                  "Mirostat 2.0"
                ],
                "options_metadata": [],
                "override_skip": false,
                "placeholder": "",
                "real_time_refresh": true,
                "required": false,
                "show": true,
                "title_case": false,
                "toggle": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "str",
                "value": "Disabled"
              },
              "mirostat_eta": {
                "_input_type": "FloatInput",
                "advanced": true,
                "display_name": "Mirostat Eta",
                "dynamic": false,
                "info": "Learning rate for Mirostat algorithm. (Default: 0.1)",
                "list": false,
                "list_add_label": "Add More",
                "name": "mirostat_eta",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "float",
                "value": ""
              },
              "mirostat_tau": {
                "_input_type": "FloatInput",
                "advanced": true,
                "display_name": "Mirostat Tau",
                "dynamic": false,
                "info": "Controls the balance between coherence and diversity of the output. (Default: 5.0)",
                "list": false,
                "list_add_label": "Add More",
                "name": "mirostat_tau",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "float",
                "value": ""
              },
              "model_name": {
                "_input_type": "DropdownInput",
                "advanced": false,
                "combobox": false,
                "dialog_inputs": {},
                "display_name": "Model Name",
                "dynamic": false,
                "external_options": {},
                "info": "Refer to https://ollama.com/library for more models.",
                "name": "model_name",
                "options": [
                  "mistral:7b",
                  "llama3.2:3b"
                ],
                "options_metadata": [],
                "override_skip": false,
                "placeholder": "",
                "real_time_refresh": true,
                "refresh_button": true,
                "required": true,
                "show": true,
                "title_case": false,
                "toggle": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "str",
                "value": "mistral:7b"
              },
              "num_ctx": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Context Window Size",
                "dynamic": false,
                "info": "Size of the context window for generating tokens. (Default: 2048)",
                "list": false,
                "list_add_label": "Add More",
                "name": "num_ctx",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": ""
              },
              "num_gpu": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Number of GPUs",
                "dynamic": false,
                "info": "Number of GPUs to use for computation. (Default: 1 on macOS, 0 to disable)",
                "list": false,
                "list_add_label": "Add More",
                "name": "num_gpu",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": ""
              },
              "num_thread": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Number of Threads",
                "dynamic": false,
                "info": "Number of threads to use during computation. (Default: detected for optimal performance)",
                "list": false,
                "list_add_label": "Add More",
                "name": "num_thread",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": ""
              },
              "repeat_last_n": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Repeat Last N",
                "dynamic": false,
                "info": "How far back the model looks to prevent repetition. (Default: 64, 0 = disabled, -1 = num_ctx)",
                "list": false,
                "list_add_label": "Add More",
                "name": "repeat_last_n",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": ""
              },
              "repeat_penalty": {
                "_input_type": "FloatInput",
                "advanced": true,
                "display_name": "Repeat Penalty",
                "dynamic": false,
                "info": "Penalty for repetitions in generated text. (Default: 1.1)",
                "list": false,
                "list_add_label": "Add More",
                "name": "repeat_penalty",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "float",
                "value": ""
              },
              "stop_tokens": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "Stop Tokens",
                "dynamic": false,
                "info": "Comma-separated list of tokens to signal the model to stop generating text.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "stop_tokens",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "stream": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Stream",
                "dynamic": false,
                "info": "Stream the response from the model. Streaming works only in Chat.",
                "list": false,
                "list_add_label": "Add More",
                "name": "stream",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": false
              },
              "system": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "System",
                "dynamic": false,
                "info": "System to use for generating text.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "system",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "system_message": {
                "_input_type": "MultilineInput",
                "advanced": false,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "System Message",
                "dynamic": false,
                "info": "System message to pass to the model.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "system_message",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "You are an intelligent shopping assistant.\n\nYour job is to help users discover, compare, and decide on products clearly,\naccurately, and efficiently.\n\nRules:\n- Communicate in natural, concise, and user-friendly language.\n- Use tool and retrieved data as the source of truth.\n- Never invent prices, reviews, availability, or product details.\n- Always respect user constraints (budget, preferences, size, allergies,\n  sustainability, availability).\n- Automatically apply remembered user preferences when available.\n- Summarize reviews honestly, including pros and cons, avoiding promotional tone.\n- Use ₹ for prices unless stated otherwise.\n- Use headings and bullet points for clarity.\n- Do not mention tools, embeddings, vector databases, or internal reasoning.\n- If required information is missing, say so and ask a minimal clarification\n  question.\n\nYour goal is to help users make confident, well-informed shopping decisions.\n"
              },
              "tags": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "Tags",
                "dynamic": false,
                "info": "Comma-separated list of tags to add to the run trace.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "tags",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "temperature": {
                "_input_type": "SliderInput",
                "advanced": true,
                "display_name": "Temperature",
                "dynamic": false,
                "info": "",
                "max_label": "",
                "max_label_icon": "",
                "min_label": "",
                "min_label_icon": "",
                "name": "temperature",
                "override_skip": false,
                "placeholder": "",
                "range_spec": {
                  "max": 1,
                  "min": 0,
                  "step": 0.01,
                  "step_type": "float"
                },
                "required": false,
                "show": true,
                "slider_buttons": false,
                "slider_buttons_options": [],
                "slider_input": false,
                "title_case": false,
                "tool_mode": false,
                "track_in_telemetry": false,
                "type": "slider",
                "value": 0.1
              },
              "template": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "Template",
                "dynamic": false,
                "info": "Template to use for generating text.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "template",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "tfs_z": {
                "_input_type": "FloatInput",
                "advanced": true,
                "display_name": "TFS Z",
                "dynamic": false,
                "info": "Tail free sampling value. (Default: 1)",
                "list": false,
                "list_add_label": "Add More",
                "name": "tfs_z",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "float",
                "value": ""
              },
              "timeout": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Timeout",
                "dynamic": false,
                "info": "Timeout for the request stream.",
                "list": false,
                "list_add_label": "Add More",
                "name": "timeout",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": ""
              },
              "tool_model_enabled": {
                "_input_type": "BoolInput",
                "advanced": false,
                "display_name": "Tool Model Enabled",
                "dynamic": false,
                "info": "Whether to enable tool calling in the model.",
                "list": false,
                "list_add_label": "Add More",
                "name": "tool_model_enabled",
                "override_skip": false,
                "placeholder": "",
                "real_time_refresh": true,
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              },
              "top_k": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Top K",
                "dynamic": false,
                "info": "Limits token selection to top K. (Default: 40)",
                "list": false,
                "list_add_label": "Add More",
                "name": "top_k",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": ""
              },
              "top_p": {
                "_input_type": "FloatInput",
                "advanced": true,
                "display_name": "Top P",
                "dynamic": false,
                "info": "Works together with top-k. (Default: 0.9)",
                "list": false,
                "list_add_label": "Add More",
                "name": "top_p",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "float",
                "value": ""
              }
            },
            "tool_mode": false
          },
          "selected_output": "model_output",
          "showNode": true,
          "type": "OllamaModel (rLaRF)"
        },
        "dragging": false,
        "id": "OllamaModel (rLaRF)-BmD8c",
        "measured": {
          "height": 617,
          "width": 320
        },
        "position": {
          "x": -245.1663715014306,
          "y": 222.65476757751986
        },
        "selected": false,
        "type": "genericNode"
      },
      {
        "data": {
          "id": "DuckDuckGoSearchComponent-uiYpY",
          "node": {
            "base_classes": [
              "DataFrame"
            ],
            "beta": false,
            "conditional_paths": [],
            "custom_fields": {},
            "description": "Search the web using DuckDuckGo with customizable result limits",
            "display_name": "DuckDuckGo Search",
            "documentation": "https://python.langchain.com/docs/integrations/tools/ddg",
            "edited": false,
            "field_order": [
              "input_value",
              "max_results",
              "max_snippet_length"
            ],
            "frozen": false,
            "icon": "DuckDuckGo",
            "last_updated": "2026-01-14T15:52:03.646Z",
            "legacy": false,
            "lf_version": "1.7.1",
            "metadata": {
              "code_hash": "2e522a5a4389",
              "dependencies": {
                "dependencies": [
                  {
                    "name": "langchain_community",
                    "version": "0.3.21"
                  },
                  {
                    "name": "lfx",
                    "version": "0.2.1"
                  }
                ],
                "total_dependencies": 2
              },
              "module": "lfx.components.duckduckgo.duck_duck_go_search_run.DuckDuckGoSearchComponent"
            },
            "minimized": false,
            "output_types": [],
            "outputs": [
              {
                "allows_loop": false,
                "cache": true,
                "display_name": "Toolset",
                "group_outputs": false,
                "hidden": null,
                "loop_types": null,
                "method": "to_toolkit",
                "name": "component_as_tool",
                "options": null,
                "required_inputs": null,
                "selected": "Tool",
                "tool_mode": true,
                "types": [
                  "Tool"
                ],
                "value": "__UNDEFINED__"
              }
            ],
            "pinned": false,
            "template": {
              "_frontend_node_flow_id": {
                "value": "497837db-2331-441c-bcdd-88e652728e3e"
              },
              "_frontend_node_folder_id": {
                "value": "5a69c093-1586-47bb-8a87-3fbd6c0b29f6"
              },
              "_type": "Component",
              "code": {
                "advanced": true,
                "dynamic": true,
                "fileTypes": [],
                "file_path": "",
                "info": "",
                "list": false,
                "load_from_db": false,
                "multiline": true,
                "name": "code",
                "password": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "type": "code",
                "value": "from langchain_community.tools import DuckDuckGoSearchRun\n\nfrom lfx.custom.custom_component.component import Component\nfrom lfx.inputs.inputs import IntInput, MessageTextInput\nfrom lfx.schema.data import Data\nfrom lfx.schema.dataframe import DataFrame\nfrom lfx.template.field.base import Output\n\n\nclass DuckDuckGoSearchComponent(Component):\n    \"\"\"Component for performing web searches using DuckDuckGo.\"\"\"\n\n    display_name = \"DuckDuckGo Search\"\n    description = \"Search the web using DuckDuckGo with customizable result limits\"\n    documentation = \"https://python.langchain.com/docs/integrations/tools/ddg\"\n    icon = \"DuckDuckGo\"\n\n    inputs = [\n        MessageTextInput(\n            name=\"input_value\",\n            display_name=\"Search Query\",\n            required=True,\n            info=\"The search query to execute with DuckDuckGo\",\n            tool_mode=True,\n        ),\n        IntInput(\n            name=\"max_results\",\n            display_name=\"Max Results\",\n            value=5,\n            required=False,\n            advanced=True,\n            info=\"Maximum number of search results to return\",\n        ),\n        IntInput(\n            name=\"max_snippet_length\",\n            display_name=\"Max Snippet Length\",\n            value=100,\n            required=False,\n            advanced=True,\n            info=\"Maximum length of each result snippet\",\n        ),\n    ]\n\n    outputs = [\n        Output(display_name=\"DataFrame\", name=\"dataframe\", method=\"fetch_content_dataframe\"),\n    ]\n\n    def _build_wrapper(self) -> DuckDuckGoSearchRun:\n        \"\"\"Build the DuckDuckGo search wrapper.\"\"\"\n        return DuckDuckGoSearchRun()\n\n    def run_model(self) -> DataFrame:\n        return self.fetch_content_dataframe()\n\n    def fetch_content(self) -> list[Data]:\n        \"\"\"Execute the search and return results as Data objects.\"\"\"\n        try:\n            wrapper = self._build_wrapper()\n\n            full_results = wrapper.run(f\"{self.input_value} (site:*)\")\n\n            result_list = full_results.split(\"\\n\")[: self.max_results]\n\n            data_results = []\n            for result in result_list:\n                if result.strip():\n                    snippet = result[: self.max_snippet_length]\n                    data_results.append(\n                        Data(\n                            text=snippet,\n                            data={\n                                \"content\": result,\n                                \"snippet\": snippet,\n                            },\n                        )\n                    )\n        except (ValueError, AttributeError) as e:\n            error_data = [Data(text=str(e), data={\"error\": str(e)})]\n            self.status = error_data\n            return error_data\n        else:\n            self.status = data_results\n            return data_results\n\n    def fetch_content_dataframe(self) -> DataFrame:\n        \"\"\"Convert the search results to a DataFrame.\n\n        Returns:\n            DataFrame: A DataFrame containing the search results.\n        \"\"\"\n        data = self.fetch_content()\n        return DataFrame(data)\n"
              },
              "input_value": {
                "_input_type": "MessageTextInput",
                "advanced": false,
                "display_name": "Search Query",
                "dynamic": false,
                "info": "The search query to execute with DuckDuckGo",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "input_value",
                "override_skip": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "tool_mode": true,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "is_refresh": false,
              "max_results": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Max Results",
                "dynamic": false,
                "info": "Maximum number of search results to return",
                "list": false,
                "list_add_label": "Add More",
                "name": "max_results",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": 5
              },
              "max_snippet_length": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Max Snippet Length",
                "dynamic": false,
                "info": "Maximum length of each result snippet",
                "list": false,
                "list_add_label": "Add More",
                "name": "max_snippet_length",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": 100
              },
              "tools_metadata": {
                "_input_type": "ToolsInput",
                "advanced": false,
                "display_name": "Actions",
                "dynamic": false,
                "info": "Modify tool names and descriptions to help agents understand when to use each tool.",
                "is_list": true,
                "list_add_label": "Add More",
                "name": "tools_metadata",
                "override_skip": false,
                "placeholder": "",
                "real_time_refresh": true,
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "tools",
                "value": [
                  {
                    "args": {
                      "input_value": {
                        "description": "The search query to execute with DuckDuckGo",
                        "title": "Input Value",
                        "type": "string"
                      }
                    },
                    "description": "Search the web using DuckDuckGo with customizable result limits",
                    "display_description": "Search the web using DuckDuckGo with customizable result limits",
                    "display_name": "fetch_content_dataframe",
                    "name": "fetch_content_dataframe",
                    "readonly": false,
                    "status": true,
                    "tags": [
                      "fetch_content_dataframe"
                    ]
                  }
                ]
              }
            },
            "tool_mode": true
          },
          "showNode": true,
          "type": "DuckDuckGoSearchComponent"
        },
        "dragging": false,
        "id": "DuckDuckGoSearchComponent-uiYpY",
        "measured": {
          "height": 217,
          "width": 320
        },
        "position": {
          "x": 654.1384916409528,
          "y": 771.5771826282405
        },
        "selected": false,
        "type": "genericNode"
      },
      {
        "data": {
          "id": "CustomAgent (480Vz)-2gGag",
          "node": {
            "base_classes": [
              "Message"
            ],
            "beta": false,
            "conditional_paths": [],
            "custom_fields": {},
            "description": "Agent with connected LLM, instructions, and tool support.",
            "display_name": "Intent Understanding Agent",
            "documentation": "https://docs.langflow.org/agents",
            "edited": true,
            "field_order": [
              "llm",
              "system_prompt",
              "input_value",
              "context_id",
              "n_messages",
              "format_instructions",
              "output_schema",
              "tools",
              "input_value",
              "handle_parsing_errors",
              "verbose",
              "max_iterations",
              "agent_description",
              "add_current_date_tool"
            ],
            "frozen": false,
            "icon": "bot",
            "legacy": false,
            "lf_version": "1.7.1",
            "metadata": {
              "code_hash": "75447427bcb5",
              "dependencies": {
                "dependencies": [
                  {
                    "name": "langchain_core",
                    "version": "0.3.81"
                  },
                  {
                    "name": "pydantic",
                    "version": "2.11.10"
                  },
                  {
                    "name": "lfx",
                    "version": "0.2.1"
                  }
                ],
                "total_dependencies": 3
              },
              "module": "custom_components.intent_understanding_agent"
            },
            "minimized": false,
            "official": false,
            "output_types": [],
            "outputs": [
              {
                "allows_loop": false,
                "cache": true,
                "display_name": "Response",
                "group_outputs": false,
                "hidden": null,
                "loop_types": null,
                "method": "message_response",
                "name": "response",
                "options": null,
                "required_inputs": null,
                "selected": "Message",
                "tool_mode": true,
                "types": [
                  "Message"
                ],
                "value": "__UNDEFINED__"
              }
            ],
            "pinned": false,
            "template": {
              "_type": "Component",
              "add_current_date_tool": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Current Date",
                "dynamic": false,
                "info": "If true, adds a tool that returns the current date.",
                "list": false,
                "list_add_label": "Add More",
                "name": "add_current_date_tool",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              },
              "agent_description": {
                "_input_type": "MultilineInput",
                "advanced": true,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Agent Description [Deprecated]",
                "dynamic": false,
                "info": "The description of the agent. This is only used when in Tool Mode. Defaults to 'A helpful assistant with access to the following tools:' and tools are added dynamically. This feature is deprecated and will be removed in future versions.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "agent_description",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "A helpful assistant with access to the following tools:"
              },
              "code": {
                "advanced": true,
                "dynamic": true,
                "fileTypes": [],
                "file_path": "",
                "info": "",
                "list": false,
                "load_from_db": false,
                "multiline": true,
                "name": "code",
                "password": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "type": "code",
                "value": "import json\r\nimport re\r\n\r\nfrom langchain_core.tools import StructuredTool, Tool\r\nfrom pydantic import ValidationError\r\n\r\nfrom lfx.base.agents.agent import LCToolsAgentComponent\r\nfrom lfx.base.agents.events import ExceptionWithMessageError\r\nfrom lfx.base.models.model_utils import get_model_name\r\nfrom lfx.components.helpers import CurrentDateComponent\r\nfrom lfx.components.langchain_utilities.tool_calling import ToolCallingAgentComponent\r\nfrom lfx.components.models_and_agents.memory import MemoryComponent\r\nfrom lfx.custom.custom_component.component import get_component_toolkit\r\nfrom lfx.io import BoolInput, IntInput, MessageTextInput, MultilineInput, Output, TableInput, HandleInput\r\nfrom lfx.log.logger import logger\r\nfrom lfx.schema.data import Data\r\nfrom lfx.schema.dotdict import dotdict\r\nfrom lfx.schema.message import Message\r\nfrom lfx.schema.table import EditMode\r\n\r\nclass AgentComponent(ToolCallingAgentComponent):\r\n    display_name: str = \"Intent Understanding Agent\"\r\n    description: str = \"Agent with connected LLM, instructions, and tool support.\"\r\n    documentation: str = \"https://docs.langflow.org/agents\"\r\n    icon = \"bot\"\r\n    name = \"CustomAgent\"\r\n\r\n    inputs = [\r\n        # REPLACED Model Provider/API Key with a direct Language Model handle\r\n        HandleInput(\r\n            name=\"llm\",\r\n            display_name=\"Language Model\",\r\n            input_types=[\"LanguageModel\"],\r\n            info=\"Connect a Language Model component here (e.g., OpenAI, Anthropic).\",\r\n            required=True\r\n        ),\r\n        MultilineInput(\r\n            name=\"system_prompt\",\r\n            display_name=\"Agent Instructions\",\r\n            info=\"System Prompt: Initial instructions and context provided to guide the agent's behavior.\",\r\n            value=\"You are a helpful assistant that can use tools to answer questions and perform tasks.\",\r\n            advanced=False,\r\n        ),\r\n        MessageTextInput(\r\n            name=\"input_value\",\r\n            display_name=\"Input Value\",\r\n            info=\"The user message or task for the agent.\",\r\n            required=True\r\n        ),\r\n        MessageTextInput(\r\n            name=\"context_id\",\r\n            display_name=\"Context ID\",\r\n            info=\"The context ID of the chat. Adds an extra layer to the local memory.\",\r\n            value=\"\",\r\n            advanced=True,\r\n        ),\r\n        IntInput(\r\n            name=\"n_messages\",\r\n            display_name=\"Number of Chat History Messages\",\r\n            value=100,\r\n            info=\"Number of chat history messages to retrieve.\",\r\n            advanced=True,\r\n            show=True,\r\n        ),\r\n        MultilineInput(\r\n            name=\"format_instructions\",\r\n            display_name=\"Output Format Instructions\",\r\n            info=\"Generic Template for structured output formatting.\",\r\n            value=(\r\n                \"You are an AI that extracts structured JSON objects. \"\r\n                \"Always return valid JSON.\"\r\n            ),\r\n            advanced=True,\r\n        ),\r\n        TableInput(\r\n            name=\"output_schema\",\r\n            display_name=\"Output Schema\",\r\n            info=\"Schema Validation: Define the structure for structured output.\",\r\n            advanced=True,\r\n            required=False,\r\n            value=[],\r\n            table_schema=[\r\n                {\"name\": \"name\", \"display_name\": \"Name\", \"type\": \"str\", \"edit_mode\": EditMode.INLINE},\r\n                {\"name\": \"description\", \"display_name\": \"Description\", \"type\": \"str\", \"edit_mode\": EditMode.POPOVER},\r\n                {\"name\": \"type\", \"display_name\": \"Type\", \"type\": \"str\", \"options\": [\"str\", \"int\", \"float\", \"bool\", \"dict\"], \"edit_mode\": EditMode.INLINE},\r\n                {\"name\": \"multiple\", \"display_name\": \"As List\", \"type\": \"boolean\", \"edit_mode\": EditMode.INLINE},\r\n            ],\r\n        ),\r\n        *LCToolsAgentComponent.get_base_inputs(),\r\n        BoolInput(\r\n            name=\"add_current_date_tool\",\r\n            display_name=\"Current Date\",\r\n            advanced=True,\r\n            info=\"If true, adds a tool that returns the current date.\",\r\n            value=True,\r\n        ),\r\n    ]\r\n    \r\n    outputs = [\r\n        Output(name=\"response\", display_name=\"Response\", method=\"message_response\"),\r\n    ]\r\n\r\n    async def get_agent_requirements(self):\r\n        # Directly use the connected llm handle\r\n        llm_model = self.llm\r\n        if llm_model is None:\r\n            raise ValueError(\"No language model connected.\")\r\n        \r\n        self.model_name = get_model_name(llm_model)\r\n\r\n        # Get memory data\r\n        self.chat_history = await self.get_memory_data()\r\n        if isinstance(self.chat_history, Message):\r\n            self.chat_history = [self.chat_history]\r\n\r\n        # Add current date tool if enabled\r\n        if self.add_current_date_tool:\r\n            if not hasattr(self, \"tools\") or not isinstance(self.tools, list):\r\n                self.tools = []\r\n            \r\n            # Helper to get base args for component initialization\r\n            current_date_tool_list = await CurrentDateComponent().to_toolkit()\r\n            if current_date_tool_list:\r\n                current_date_tool = current_date_tool_list[0]\r\n                self.tools.append(current_date_tool)\r\n\r\n        self.set_tools_callbacks(self.tools, self._get_shared_callbacks())\r\n        return llm_model, self.chat_history, self.tools\r\n\r\n    async def message_response(self) -> Message:\r\n        llm_model, self.chat_history, self.tools = await self.get_agent_requirements()\r\n        \r\n        self.set(\r\n            llm=llm_model,\r\n            tools=self.tools or [],\r\n            chat_history=self.chat_history,\r\n            input_value=self.input_value,\r\n            system_prompt=self.system_prompt,\r\n        )\r\n        \r\n        agent = self.create_agent_runnable()\r\n        result = await self.run_agent(agent)\r\n        return result\r\n\r\n    async def get_memory_data(self):\r\n        messages = (\r\n            await MemoryComponent()\r\n            .set(\r\n                session_id=self.graph.session_id if hasattr(self, \"graph\") else \"default\",\r\n                context_id=self.context_id,\r\n                order=\"Ascending\",\r\n                n_messages=self.n_messages,\r\n            )\r\n            .retrieve_messages()\r\n        )\r\n        # Filter to avoid echoing the current input if it's already in the DB\r\n        return [\r\n            msg for msg in messages \r\n            if getattr(msg, \"id\", None) != getattr(self.input_value, \"id\", None)\r\n        ]\r\n\r\n    # Simplified Tool building for custom component\r\n    async def _get_tools(self) -> list[Tool]:\r\n        component_toolkit = get_component_toolkit()\r\n        tools = component_toolkit(component=self).get_tools(\r\n            tool_name=\"Call_Agent\",\r\n            tool_description=self.get_tool_description(),\r\n            callbacks=self.get_langchain_callbacks(),\r\n        )\r\n        return tools"
              },
              "context_id": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "Context ID",
                "dynamic": false,
                "info": "The context ID of the chat. Adds an extra layer to the local memory.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "context_id",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "format_instructions": {
                "_input_type": "MultilineInput",
                "advanced": true,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Output Format Instructions",
                "dynamic": false,
                "info": "Generic Template for structured output formatting.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "format_instructions",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "You are an AI that extracts structured JSON objects. Always return valid JSON."
              },
              "handle_parsing_errors": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Handle Parse Errors",
                "dynamic": false,
                "info": "Should the Agent fix errors when reading user input for better processing?",
                "list": false,
                "list_add_label": "Add More",
                "name": "handle_parsing_errors",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              },
              "input_value": {
                "_input_type": "MessageInput",
                "advanced": false,
                "display_name": "Input",
                "dynamic": false,
                "info": "The input provided by the user for the agent to process.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "input_value",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": true,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "llm": {
                "_input_type": "HandleInput",
                "advanced": false,
                "display_name": "Language Model",
                "dynamic": false,
                "info": "Connect a Language Model component here (e.g., OpenAI, Anthropic).",
                "input_types": [
                  "LanguageModel"
                ],
                "list": false,
                "list_add_label": "Add More",
                "name": "llm",
                "override_skip": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "other",
                "value": ""
              },
              "max_iterations": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Max Iterations",
                "dynamic": false,
                "info": "The maximum number of attempts the agent can make to complete its task before it stops.",
                "list": false,
                "list_add_label": "Add More",
                "name": "max_iterations",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": 15
              },
              "n_messages": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Number of Chat History Messages",
                "dynamic": false,
                "info": "Number of chat history messages to retrieve.",
                "list": false,
                "list_add_label": "Add More",
                "name": "n_messages",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": 100
              },
              "output_schema": {
                "_input_type": "TableInput",
                "advanced": true,
                "display_name": "Output Schema",
                "dynamic": false,
                "info": "Schema Validation: Define the structure for structured output.",
                "is_list": true,
                "list_add_label": "Add More",
                "name": "output_schema",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "table_icon": "Table",
                "table_schema": [
                  {
                    "display_name": "Name",
                    "edit_mode": "inline",
                    "name": "name",
                    "type": "str"
                  },
                  {
                    "display_name": "Description",
                    "edit_mode": "popover",
                    "name": "description",
                    "type": "str"
                  },
                  {
                    "display_name": "Type",
                    "edit_mode": "inline",
                    "name": "type",
                    "options": [
                      "str",
                      "int",
                      "float",
                      "bool",
                      "dict"
                    ],
                    "type": "str"
                  },
                  {
                    "display_name": "As List",
                    "edit_mode": "inline",
                    "name": "multiple",
                    "type": "boolean"
                  }
                ],
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "trigger_icon": "Table",
                "trigger_text": "Open table",
                "type": "table",
                "value": []
              },
              "system_prompt": {
                "_input_type": "MultilineInput",
                "advanced": false,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Agent Instructions",
                "dynamic": false,
                "info": "System Prompt: Initial instructions and context provided to guide the agent's behavior.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "system_prompt",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "You are an Intent Understanding Agent for an intelligent shopping assistant.\n\nYour task:\n- Understand the user’s shopping request from natural language.\n- Identify product category, budget, preferences, constraints, and usage context.\n- Convert the request into a clear structured intent.\n\nOutput ONLY valid JSON:\n{\n  \"product\": \"\",\n  \"budget_min\": null,\n  \"budget_max\": null,\n  \"currency\": \"INR\",\n  \"preferences\": [],\n  \"constraints\": [],\n  \"context\": \"\"\n}\n\nDo not suggest products.\nDo not perform comparisons.\n"
              },
              "tools": {
                "_input_type": "HandleInput",
                "advanced": false,
                "display_name": "Tools",
                "dynamic": false,
                "info": "These are the tools that the agent can use to help with tasks.",
                "input_types": [
                  "Tool"
                ],
                "list": true,
                "list_add_label": "Add More",
                "name": "tools",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "other",
                "value": ""
              },
              "verbose": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Verbose",
                "dynamic": false,
                "info": "",
                "list": false,
                "list_add_label": "Add More",
                "name": "verbose",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              }
            },
            "tool_mode": false
          },
          "showNode": true,
          "type": "CustomAgent (480Vz)"
        },
        "dragging": false,
        "id": "CustomAgent (480Vz)-2gGag",
        "measured": {
          "height": 391,
          "width": 320
        },
        "position": {
          "x": 304.3634503372881,
          "y": 105.23524153617662
        },
        "selected": false,
        "type": "genericNode"
      },
      {
        "data": {
          "id": "CustomAgent (z1z0j)-SSxiC",
          "node": {
            "base_classes": [
              "Message"
            ],
            "beta": false,
            "conditional_paths": [],
            "custom_fields": {},
            "description": "Agent with connected LLM, instructions, and tool support.",
            "display_name": "Session Personalization Agent",
            "documentation": "https://docs.langflow.org/agents",
            "edited": true,
            "field_order": [
              "llm",
              "system_prompt",
              "input_value",
              "context_id",
              "n_messages",
              "format_instructions",
              "output_schema",
              "tools",
              "input_value",
              "handle_parsing_errors",
              "verbose",
              "max_iterations",
              "agent_description",
              "add_current_date_tool"
            ],
            "frozen": false,
            "icon": "bot",
            "legacy": false,
            "lf_version": "1.7.1",
            "metadata": {
              "code_hash": "08e59166533a",
              "dependencies": {
                "dependencies": [
                  {
                    "name": "langchain_core",
                    "version": "0.3.81"
                  },
                  {
                    "name": "pydantic",
                    "version": "2.11.10"
                  },
                  {
                    "name": "lfx",
                    "version": "0.2.1"
                  }
                ],
                "total_dependencies": 3
              },
              "module": "custom_components.session_personalization_agent"
            },
            "minimized": false,
            "official": false,
            "output_types": [],
            "outputs": [
              {
                "allows_loop": false,
                "cache": true,
                "display_name": "Response",
                "group_outputs": false,
                "hidden": null,
                "loop_types": null,
                "method": "message_response",
                "name": "response",
                "options": null,
                "required_inputs": null,
                "selected": "Message",
                "tool_mode": true,
                "types": [
                  "Message"
                ],
                "value": "__UNDEFINED__"
              }
            ],
            "pinned": false,
            "template": {
              "_type": "Component",
              "add_current_date_tool": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Current Date",
                "dynamic": false,
                "info": "If true, adds a tool that returns the current date.",
                "list": false,
                "list_add_label": "Add More",
                "name": "add_current_date_tool",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              },
              "agent_description": {
                "_input_type": "MultilineInput",
                "advanced": true,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Agent Description [Deprecated]",
                "dynamic": false,
                "info": "The description of the agent. This is only used when in Tool Mode. Defaults to 'A helpful assistant with access to the following tools:' and tools are added dynamically. This feature is deprecated and will be removed in future versions.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "agent_description",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "A helpful assistant with access to the following tools:"
              },
              "code": {
                "advanced": true,
                "dynamic": true,
                "fileTypes": [],
                "file_path": "",
                "info": "",
                "list": false,
                "load_from_db": false,
                "multiline": true,
                "name": "code",
                "password": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "type": "code",
                "value": "import json\r\nimport re\r\n\r\nfrom langchain_core.tools import StructuredTool, Tool\r\nfrom pydantic import ValidationError\r\n\r\nfrom lfx.base.agents.agent import LCToolsAgentComponent\r\nfrom lfx.base.agents.events import ExceptionWithMessageError\r\nfrom lfx.base.models.model_utils import get_model_name\r\nfrom lfx.components.helpers import CurrentDateComponent\r\nfrom lfx.components.langchain_utilities.tool_calling import ToolCallingAgentComponent\r\nfrom lfx.components.models_and_agents.memory import MemoryComponent\r\nfrom lfx.custom.custom_component.component import get_component_toolkit\r\nfrom lfx.io import BoolInput, IntInput, MessageTextInput, MultilineInput, Output, TableInput, HandleInput\r\nfrom lfx.log.logger import logger\r\nfrom lfx.schema.data import Data\r\nfrom lfx.schema.dotdict import dotdict\r\nfrom lfx.schema.message import Message\r\nfrom lfx.schema.table import EditMode\r\n\r\nclass AgentComponent(ToolCallingAgentComponent):\r\n    display_name: str = \"Session Personalization Agent\"\r\n    description: str = \"Agent with connected LLM, instructions, and tool support.\"\r\n    documentation: str = \"https://docs.langflow.org/agents\"\r\n    icon = \"bot\"\r\n    name = \"CustomAgent\"\r\n\r\n    inputs = [\r\n        # REPLACED Model Provider/API Key with a direct Language Model handle\r\n        HandleInput(\r\n            name=\"llm\",\r\n            display_name=\"Language Model\",\r\n            input_types=[\"LanguageModel\"],\r\n            info=\"Connect a Language Model component here (e.g., OpenAI, Anthropic).\",\r\n            required=True\r\n        ),\r\n        MultilineInput(\r\n            name=\"system_prompt\",\r\n            display_name=\"Agent Instructions\",\r\n            info=\"System Prompt: Initial instructions and context provided to guide the agent's behavior.\",\r\n            value=\"You are a helpful assistant that can use tools to answer questions and perform tasks.\",\r\n            advanced=False,\r\n        ),\r\n        MessageTextInput(\r\n            name=\"input_value\",\r\n            display_name=\"Input Value\",\r\n            info=\"The user message or task for the agent.\",\r\n            required=True\r\n        ),\r\n        MessageTextInput(\r\n            name=\"context_id\",\r\n            display_name=\"Context ID\",\r\n            info=\"The context ID of the chat. Adds an extra layer to the local memory.\",\r\n            value=\"\",\r\n            advanced=True,\r\n        ),\r\n        IntInput(\r\n            name=\"n_messages\",\r\n            display_name=\"Number of Chat History Messages\",\r\n            value=100,\r\n            info=\"Number of chat history messages to retrieve.\",\r\n            advanced=True,\r\n            show=True,\r\n        ),\r\n        MultilineInput(\r\n            name=\"format_instructions\",\r\n            display_name=\"Output Format Instructions\",\r\n            info=\"Generic Template for structured output formatting.\",\r\n            value=(\r\n                \"You are an AI that extracts structured JSON objects. \"\r\n                \"Always return valid JSON.\"\r\n            ),\r\n            advanced=True,\r\n        ),\r\n        TableInput(\r\n            name=\"output_schema\",\r\n            display_name=\"Output Schema\",\r\n            info=\"Schema Validation: Define the structure for structured output.\",\r\n            advanced=True,\r\n            required=False,\r\n            value=[],\r\n            table_schema=[\r\n                {\"name\": \"name\", \"display_name\": \"Name\", \"type\": \"str\", \"edit_mode\": EditMode.INLINE},\r\n                {\"name\": \"description\", \"display_name\": \"Description\", \"type\": \"str\", \"edit_mode\": EditMode.POPOVER},\r\n                {\"name\": \"type\", \"display_name\": \"Type\", \"type\": \"str\", \"options\": [\"str\", \"int\", \"float\", \"bool\", \"dict\"], \"edit_mode\": EditMode.INLINE},\r\n                {\"name\": \"multiple\", \"display_name\": \"As List\", \"type\": \"boolean\", \"edit_mode\": EditMode.INLINE},\r\n            ],\r\n        ),\r\n        *LCToolsAgentComponent.get_base_inputs(),\r\n        BoolInput(\r\n            name=\"add_current_date_tool\",\r\n            display_name=\"Current Date\",\r\n            advanced=True,\r\n            info=\"If true, adds a tool that returns the current date.\",\r\n            value=True,\r\n        ),\r\n    ]\r\n    \r\n    outputs = [\r\n        Output(name=\"response\", display_name=\"Response\", method=\"message_response\"),\r\n    ]\r\n\r\n    async def get_agent_requirements(self):\r\n        # Directly use the connected llm handle\r\n        llm_model = self.llm\r\n        if llm_model is None:\r\n            raise ValueError(\"No language model connected.\")\r\n        \r\n        self.model_name = get_model_name(llm_model)\r\n\r\n        # Get memory data\r\n        self.chat_history = await self.get_memory_data()\r\n        if isinstance(self.chat_history, Message):\r\n            self.chat_history = [self.chat_history]\r\n\r\n        # Add current date tool if enabled\r\n        if self.add_current_date_tool:\r\n            if not hasattr(self, \"tools\") or not isinstance(self.tools, list):\r\n                self.tools = []\r\n            \r\n            # Helper to get base args for component initialization\r\n            current_date_tool_list = await CurrentDateComponent().to_toolkit()\r\n            if current_date_tool_list:\r\n                current_date_tool = current_date_tool_list[0]\r\n                self.tools.append(current_date_tool)\r\n\r\n        self.set_tools_callbacks(self.tools, self._get_shared_callbacks())\r\n        return llm_model, self.chat_history, self.tools\r\n\r\n    async def message_response(self) -> Message:\r\n        llm_model, self.chat_history, self.tools = await self.get_agent_requirements()\r\n        \r\n        self.set(\r\n            llm=llm_model,\r\n            tools=self.tools or [],\r\n            chat_history=self.chat_history,\r\n            input_value=self.input_value,\r\n            system_prompt=self.system_prompt,\r\n        )\r\n        \r\n        agent = self.create_agent_runnable()\r\n        result = await self.run_agent(agent)\r\n        return result\r\n\r\n    async def get_memory_data(self):\r\n        messages = (\r\n            await MemoryComponent()\r\n            .set(\r\n                session_id=self.graph.session_id if hasattr(self, \"graph\") else \"default\",\r\n                context_id=self.context_id,\r\n                order=\"Ascending\",\r\n                n_messages=self.n_messages,\r\n            )\r\n            .retrieve_messages()\r\n        )\r\n        # Filter to avoid echoing the current input if it's already in the DB\r\n        return [\r\n            msg for msg in messages \r\n            if getattr(msg, \"id\", None) != getattr(self.input_value, \"id\", None)\r\n        ]\r\n\r\n    # Simplified Tool building for custom component\r\n    async def _get_tools(self) -> list[Tool]:\r\n        component_toolkit = get_component_toolkit()\r\n        tools = component_toolkit(component=self).get_tools(\r\n            tool_name=\"Call_Agent\",\r\n            tool_description=self.get_tool_description(),\r\n            callbacks=self.get_langchain_callbacks(),\r\n        )\r\n        return tools"
              },
              "context_id": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "Context ID",
                "dynamic": false,
                "info": "The context ID of the chat. Adds an extra layer to the local memory.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "context_id",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "format_instructions": {
                "_input_type": "MultilineInput",
                "advanced": true,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Output Format Instructions",
                "dynamic": false,
                "info": "Generic Template for structured output formatting.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "format_instructions",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "You are an AI that extracts structured JSON objects. Always return valid JSON."
              },
              "handle_parsing_errors": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Handle Parse Errors",
                "dynamic": false,
                "info": "Should the Agent fix errors when reading user input for better processing?",
                "list": false,
                "list_add_label": "Add More",
                "name": "handle_parsing_errors",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              },
              "input_value": {
                "_input_type": "MessageInput",
                "advanced": false,
                "display_name": "Input",
                "dynamic": false,
                "info": "The input provided by the user for the agent to process.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "input_value",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": true,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "llm": {
                "_input_type": "HandleInput",
                "advanced": false,
                "display_name": "Language Model",
                "dynamic": false,
                "info": "Connect a Language Model component here (e.g., OpenAI, Anthropic).",
                "input_types": [
                  "LanguageModel"
                ],
                "list": false,
                "list_add_label": "Add More",
                "name": "llm",
                "override_skip": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "other",
                "value": ""
              },
              "max_iterations": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Max Iterations",
                "dynamic": false,
                "info": "The maximum number of attempts the agent can make to complete its task before it stops.",
                "list": false,
                "list_add_label": "Add More",
                "name": "max_iterations",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": 15
              },
              "n_messages": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Number of Chat History Messages",
                "dynamic": false,
                "info": "Number of chat history messages to retrieve.",
                "list": false,
                "list_add_label": "Add More",
                "name": "n_messages",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": 100
              },
              "output_schema": {
                "_input_type": "TableInput",
                "advanced": true,
                "display_name": "Output Schema",
                "dynamic": false,
                "info": "Schema Validation: Define the structure for structured output.",
                "is_list": true,
                "list_add_label": "Add More",
                "name": "output_schema",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "table_icon": "Table",
                "table_schema": [
                  {
                    "display_name": "Name",
                    "edit_mode": "inline",
                    "name": "name",
                    "type": "str"
                  },
                  {
                    "display_name": "Description",
                    "edit_mode": "popover",
                    "name": "description",
                    "type": "str"
                  },
                  {
                    "display_name": "Type",
                    "edit_mode": "inline",
                    "name": "type",
                    "options": [
                      "str",
                      "int",
                      "float",
                      "bool",
                      "dict"
                    ],
                    "type": "str"
                  },
                  {
                    "display_name": "As List",
                    "edit_mode": "inline",
                    "name": "multiple",
                    "type": "boolean"
                  }
                ],
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "trigger_icon": "Table",
                "trigger_text": "Open table",
                "type": "table",
                "value": []
              },
              "system_prompt": {
                "_input_type": "MultilineInput",
                "advanced": false,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Agent Instructions",
                "dynamic": false,
                "info": "System Prompt: Initial instructions and context provided to guide the agent's behavior.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "system_prompt",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "You are a Session Personalization Agent.\n\nYour task:\n- Use only information mentioned earlier in this conversation.\n- Refine the current intent using session-level preferences.\n- Detect if the item is consumable or repeatedly purchased.\n\nOutput:\n{\n  \"refined_intent\": { ... },\n  \"session_preferences\": [],\n  \"is_replenishable\": true|false\n}\n\nDo not assume long-term memory.\n"
              },
              "tools": {
                "_input_type": "HandleInput",
                "advanced": false,
                "display_name": "Tools",
                "dynamic": false,
                "info": "These are the tools that the agent can use to help with tasks.",
                "input_types": [
                  "Tool"
                ],
                "list": true,
                "list_add_label": "Add More",
                "name": "tools",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "other",
                "value": ""
              },
              "verbose": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Verbose",
                "dynamic": false,
                "info": "",
                "list": false,
                "list_add_label": "Add More",
                "name": "verbose",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              }
            },
            "tool_mode": false
          },
          "showNode": true,
          "type": "CustomAgent (z1z0j)"
        },
        "dragging": false,
        "id": "CustomAgent (z1z0j)-SSxiC",
        "measured": {
          "height": 391,
          "width": 320
        },
        "position": {
          "x": 732.8497539875224,
          "y": 107.08622271591271
        },
        "selected": false,
        "type": "genericNode"
      },
      {
        "data": {
          "id": "CustomAgent (4P411)-DtJnW",
          "node": {
            "base_classes": [
              "Message"
            ],
            "beta": false,
            "conditional_paths": [],
            "custom_fields": {},
            "description": "Agent with connected LLM, instructions, and tool support.",
            "display_name": "Product Discovery Agent",
            "documentation": "https://docs.langflow.org/agents",
            "edited": true,
            "field_order": [
              "llm",
              "system_prompt",
              "input_value",
              "context_id",
              "n_messages",
              "format_instructions",
              "output_schema",
              "tools",
              "input_value",
              "handle_parsing_errors",
              "verbose",
              "max_iterations",
              "agent_description",
              "add_current_date_tool"
            ],
            "frozen": false,
            "icon": "bot",
            "legacy": false,
            "lf_version": "1.7.1",
            "metadata": {
              "code_hash": "3cbc66abdce2",
              "dependencies": {
                "dependencies": [
                  {
                    "name": "langchain_core",
                    "version": "0.3.81"
                  },
                  {
                    "name": "pydantic",
                    "version": "2.11.10"
                  },
                  {
                    "name": "lfx",
                    "version": "0.2.1"
                  }
                ],
                "total_dependencies": 3
              },
              "module": "custom_components.product_discovery_agent"
            },
            "minimized": false,
            "official": false,
            "output_types": [],
            "outputs": [
              {
                "allows_loop": false,
                "cache": true,
                "display_name": "Response",
                "group_outputs": false,
                "hidden": null,
                "loop_types": null,
                "method": "message_response",
                "name": "response",
                "options": null,
                "required_inputs": null,
                "selected": "Message",
                "tool_mode": true,
                "types": [
                  "Message"
                ],
                "value": "__UNDEFINED__"
              }
            ],
            "pinned": false,
            "template": {
              "_type": "Component",
              "add_current_date_tool": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Current Date",
                "dynamic": false,
                "info": "If true, adds a tool that returns the current date.",
                "list": false,
                "list_add_label": "Add More",
                "name": "add_current_date_tool",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              },
              "agent_description": {
                "_input_type": "MultilineInput",
                "advanced": true,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Agent Description [Deprecated]",
                "dynamic": false,
                "info": "The description of the agent. This is only used when in Tool Mode. Defaults to 'A helpful assistant with access to the following tools:' and tools are added dynamically. This feature is deprecated and will be removed in future versions.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "agent_description",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "A helpful assistant with access to the following tools:"
              },
              "code": {
                "advanced": true,
                "dynamic": true,
                "fileTypes": [],
                "file_path": "",
                "info": "",
                "list": false,
                "load_from_db": false,
                "multiline": true,
                "name": "code",
                "password": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "type": "code",
                "value": "import json\r\nimport re\r\n\r\nfrom langchain_core.tools import StructuredTool, Tool\r\nfrom pydantic import ValidationError\r\n\r\nfrom lfx.base.agents.agent import LCToolsAgentComponent\r\nfrom lfx.base.agents.events import ExceptionWithMessageError\r\nfrom lfx.base.models.model_utils import get_model_name\r\nfrom lfx.components.helpers import CurrentDateComponent\r\nfrom lfx.components.langchain_utilities.tool_calling import ToolCallingAgentComponent\r\nfrom lfx.components.models_and_agents.memory import MemoryComponent\r\nfrom lfx.custom.custom_component.component import get_component_toolkit\r\nfrom lfx.io import BoolInput, IntInput, MessageTextInput, MultilineInput, Output, TableInput, HandleInput\r\nfrom lfx.log.logger import logger\r\nfrom lfx.schema.data import Data\r\nfrom lfx.schema.dotdict import dotdict\r\nfrom lfx.schema.message import Message\r\nfrom lfx.schema.table import EditMode\r\n\r\nclass AgentComponent(ToolCallingAgentComponent):\r\n    display_name: str = \"Product Discovery Agent\"\r\n    description: str = \"Agent with connected LLM, instructions, and tool support.\"\r\n    documentation: str = \"https://docs.langflow.org/agents\"\r\n    icon = \"bot\"\r\n    name = \"CustomAgent\"\r\n\r\n    inputs = [\r\n        # REPLACED Model Provider/API Key with a direct Language Model handle\r\n        HandleInput(\r\n            name=\"llm\",\r\n            display_name=\"Language Model\",\r\n            input_types=[\"LanguageModel\"],\r\n            info=\"Connect a Language Model component here (e.g., OpenAI, Anthropic).\",\r\n            required=True\r\n        ),\r\n        MultilineInput(\r\n            name=\"system_prompt\",\r\n            display_name=\"Agent Instructions\",\r\n            info=\"System Prompt: Initial instructions and context provided to guide the agent's behavior.\",\r\n            value=\"You are a helpful assistant that can use tools to answer questions and perform tasks.\",\r\n            advanced=False,\r\n        ),\r\n        MessageTextInput(\r\n            name=\"input_value\",\r\n            display_name=\"Input Value\",\r\n            info=\"The user message or task for the agent.\",\r\n            required=True\r\n        ),\r\n        MessageTextInput(\r\n            name=\"context_id\",\r\n            display_name=\"Context ID\",\r\n            info=\"The context ID of the chat. Adds an extra layer to the local memory.\",\r\n            value=\"\",\r\n            advanced=True,\r\n        ),\r\n        IntInput(\r\n            name=\"n_messages\",\r\n            display_name=\"Number of Chat History Messages\",\r\n            value=100,\r\n            info=\"Number of chat history messages to retrieve.\",\r\n            advanced=True,\r\n            show=True,\r\n        ),\r\n        MultilineInput(\r\n            name=\"format_instructions\",\r\n            display_name=\"Output Format Instructions\",\r\n            info=\"Generic Template for structured output formatting.\",\r\n            value=(\r\n                \"You are an AI that extracts structured JSON objects. \"\r\n                \"Always return valid JSON.\"\r\n            ),\r\n            advanced=True,\r\n        ),\r\n        TableInput(\r\n            name=\"output_schema\",\r\n            display_name=\"Output Schema\",\r\n            info=\"Schema Validation: Define the structure for structured output.\",\r\n            advanced=True,\r\n            required=False,\r\n            value=[],\r\n            table_schema=[\r\n                {\"name\": \"name\", \"display_name\": \"Name\", \"type\": \"str\", \"edit_mode\": EditMode.INLINE},\r\n                {\"name\": \"description\", \"display_name\": \"Description\", \"type\": \"str\", \"edit_mode\": EditMode.POPOVER},\r\n                {\"name\": \"type\", \"display_name\": \"Type\", \"type\": \"str\", \"options\": [\"str\", \"int\", \"float\", \"bool\", \"dict\"], \"edit_mode\": EditMode.INLINE},\r\n                {\"name\": \"multiple\", \"display_name\": \"As List\", \"type\": \"boolean\", \"edit_mode\": EditMode.INLINE},\r\n            ],\r\n        ),\r\n        *LCToolsAgentComponent.get_base_inputs(),\r\n        BoolInput(\r\n            name=\"add_current_date_tool\",\r\n            display_name=\"Current Date\",\r\n            advanced=True,\r\n            info=\"If true, adds a tool that returns the current date.\",\r\n            value=True,\r\n        ),\r\n    ]\r\n    \r\n    outputs = [\r\n        Output(name=\"response\", display_name=\"Response\", method=\"message_response\"),\r\n    ]\r\n\r\n    async def get_agent_requirements(self):\r\n        # Directly use the connected llm handle\r\n        llm_model = self.llm\r\n        if llm_model is None:\r\n            raise ValueError(\"No language model connected.\")\r\n        \r\n        self.model_name = get_model_name(llm_model)\r\n\r\n        # Get memory data\r\n        self.chat_history = await self.get_memory_data()\r\n        if isinstance(self.chat_history, Message):\r\n            self.chat_history = [self.chat_history]\r\n\r\n        # Add current date tool if enabled\r\n        if self.add_current_date_tool:\r\n            if not hasattr(self, \"tools\") or not isinstance(self.tools, list):\r\n                self.tools = []\r\n            \r\n            # Helper to get base args for component initialization\r\n            current_date_tool_list = await CurrentDateComponent().to_toolkit()\r\n            if current_date_tool_list:\r\n                current_date_tool = current_date_tool_list[0]\r\n                self.tools.append(current_date_tool)\r\n\r\n        self.set_tools_callbacks(self.tools, self._get_shared_callbacks())\r\n        return llm_model, self.chat_history, self.tools\r\n\r\n    async def message_response(self) -> Message:\r\n        llm_model, self.chat_history, self.tools = await self.get_agent_requirements()\r\n        \r\n        self.set(\r\n            llm=llm_model,\r\n            tools=self.tools or [],\r\n            chat_history=self.chat_history,\r\n            input_value=self.input_value,\r\n            system_prompt=self.system_prompt,\r\n        )\r\n        \r\n        agent = self.create_agent_runnable()\r\n        result = await self.run_agent(agent)\r\n        return result\r\n\r\n    async def get_memory_data(self):\r\n        messages = (\r\n            await MemoryComponent()\r\n            .set(\r\n                session_id=self.graph.session_id if hasattr(self, \"graph\") else \"default\",\r\n                context_id=self.context_id,\r\n                order=\"Ascending\",\r\n                n_messages=self.n_messages,\r\n            )\r\n            .retrieve_messages()\r\n        )\r\n        # Filter to avoid echoing the current input if it's already in the DB\r\n        return [\r\n            msg for msg in messages \r\n            if getattr(msg, \"id\", None) != getattr(self.input_value, \"id\", None)\r\n        ]\r\n\r\n    # Simplified Tool building for custom component\r\n    async def _get_tools(self) -> list[Tool]:\r\n        component_toolkit = get_component_toolkit()\r\n        tools = component_toolkit(component=self).get_tools(\r\n            tool_name=\"Call_Agent\",\r\n            tool_description=self.get_tool_description(),\r\n            callbacks=self.get_langchain_callbacks(),\r\n        )\r\n        return tools"
              },
              "context_id": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "Context ID",
                "dynamic": false,
                "info": "The context ID of the chat. Adds an extra layer to the local memory.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "context_id",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "format_instructions": {
                "_input_type": "MultilineInput",
                "advanced": true,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Output Format Instructions",
                "dynamic": false,
                "info": "Generic Template for structured output formatting.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "format_instructions",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "You are an AI that extracts structured JSON objects. Always return valid JSON."
              },
              "handle_parsing_errors": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Handle Parse Errors",
                "dynamic": false,
                "info": "Should the Agent fix errors when reading user input for better processing?",
                "list": false,
                "list_add_label": "Add More",
                "name": "handle_parsing_errors",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              },
              "input_value": {
                "_input_type": "MessageInput",
                "advanced": false,
                "display_name": "Input",
                "dynamic": false,
                "info": "The input provided by the user for the agent to process.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "input_value",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": true,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "llm": {
                "_input_type": "HandleInput",
                "advanced": false,
                "display_name": "Language Model",
                "dynamic": false,
                "info": "Connect a Language Model component here (e.g., OpenAI, Anthropic).",
                "input_types": [
                  "LanguageModel"
                ],
                "list": false,
                "list_add_label": "Add More",
                "name": "llm",
                "override_skip": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "other",
                "value": ""
              },
              "max_iterations": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Max Iterations",
                "dynamic": false,
                "info": "The maximum number of attempts the agent can make to complete its task before it stops.",
                "list": false,
                "list_add_label": "Add More",
                "name": "max_iterations",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": 15
              },
              "n_messages": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Number of Chat History Messages",
                "dynamic": false,
                "info": "Number of chat history messages to retrieve.",
                "list": false,
                "list_add_label": "Add More",
                "name": "n_messages",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": 100
              },
              "output_schema": {
                "_input_type": "TableInput",
                "advanced": true,
                "display_name": "Output Schema",
                "dynamic": false,
                "info": "Schema Validation: Define the structure for structured output.",
                "is_list": true,
                "list_add_label": "Add More",
                "name": "output_schema",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "table_icon": "Table",
                "table_schema": [
                  {
                    "display_name": "Name",
                    "edit_mode": "inline",
                    "name": "name",
                    "type": "str"
                  },
                  {
                    "display_name": "Description",
                    "edit_mode": "popover",
                    "name": "description",
                    "type": "str"
                  },
                  {
                    "display_name": "Type",
                    "edit_mode": "inline",
                    "name": "type",
                    "options": [
                      "str",
                      "int",
                      "float",
                      "bool",
                      "dict"
                    ],
                    "type": "str"
                  },
                  {
                    "display_name": "As List",
                    "edit_mode": "inline",
                    "name": "multiple",
                    "type": "boolean"
                  }
                ],
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "trigger_icon": "Table",
                "trigger_text": "Open table",
                "type": "table",
                "value": []
              },
              "system_prompt": {
                "_input_type": "MultilineInput",
                "advanced": false,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Agent Instructions",
                "dynamic": false,
                "info": "System Prompt: Initial instructions and context provided to guide the agent's behavior.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "system_prompt",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "You are a Platform Discovery & Product Link Agent.\n\nYour task:\n- Identify relevant products matching the refined intent.\n- Provide the platform name where each product is available.\n- Provide a direct link to the product page.\n- Include displayed price and availability status.\n\nOutput for each product:\n{\n  \"product_id\": \"\",\n  \"name\": \"\",\n  \"brand\": \"\",\n  \"platform\": \"\",\n  \"price\": \"\",\n  \"availability\": \"\",\n  \"product_url\": \"\",\n  \"image_url\": \"\"\n}\n\nDo not rank products.\nDo not analyze reviews.\nDo not provide opinions.\n"
              },
              "tools": {
                "_input_type": "HandleInput",
                "advanced": false,
                "display_name": "Tools",
                "dynamic": false,
                "info": "These are the tools that the agent can use to help with tasks.",
                "input_types": [
                  "Tool"
                ],
                "list": true,
                "list_add_label": "Add More",
                "name": "tools",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "other",
                "value": ""
              },
              "verbose": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Verbose",
                "dynamic": false,
                "info": "",
                "list": false,
                "list_add_label": "Add More",
                "name": "verbose",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              }
            },
            "tool_mode": false
          },
          "showNode": true,
          "type": "CustomAgent (4P411)"
        },
        "dragging": false,
        "id": "CustomAgent (4P411)-DtJnW",
        "measured": {
          "height": 391,
          "width": 320
        },
        "position": {
          "x": 1182.82989287597,
          "y": 97.60017674371682
        },
        "selected": false,
        "type": "genericNode"
      },
      {
        "data": {
          "id": "CustomAgent (yh5AE)-O2C2m",
          "node": {
            "base_classes": [
              "Message"
            ],
            "beta": false,
            "conditional_paths": [],
            "custom_fields": {},
            "description": "Agent with connected LLM, instructions, and tool support.",
            "display_name": "Review Intelligence Agent",
            "documentation": "https://docs.langflow.org/agents",
            "edited": true,
            "field_order": [
              "llm",
              "system_prompt",
              "input_value",
              "context_id",
              "n_messages",
              "format_instructions",
              "output_schema",
              "tools",
              "input_value",
              "handle_parsing_errors",
              "verbose",
              "max_iterations",
              "agent_description",
              "add_current_date_tool"
            ],
            "frozen": false,
            "icon": "bot",
            "legacy": false,
            "lf_version": "1.7.1",
            "metadata": {
              "code_hash": "1b9321b0ce19",
              "dependencies": {
                "dependencies": [
                  {
                    "name": "langchain_core",
                    "version": "0.3.81"
                  },
                  {
                    "name": "pydantic",
                    "version": "2.11.10"
                  },
                  {
                    "name": "lfx",
                    "version": "0.2.1"
                  }
                ],
                "total_dependencies": 3
              },
              "module": "custom_components.review_intelligence_agent"
            },
            "minimized": false,
            "official": false,
            "output_types": [],
            "outputs": [
              {
                "allows_loop": false,
                "cache": true,
                "display_name": "Response",
                "group_outputs": false,
                "hidden": null,
                "loop_types": null,
                "method": "message_response",
                "name": "response",
                "options": null,
                "required_inputs": null,
                "selected": "Message",
                "tool_mode": true,
                "types": [
                  "Message"
                ],
                "value": "__UNDEFINED__"
              }
            ],
            "pinned": false,
            "template": {
              "_type": "Component",
              "add_current_date_tool": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Current Date",
                "dynamic": false,
                "info": "If true, adds a tool that returns the current date.",
                "list": false,
                "list_add_label": "Add More",
                "name": "add_current_date_tool",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              },
              "agent_description": {
                "_input_type": "MultilineInput",
                "advanced": true,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Agent Description [Deprecated]",
                "dynamic": false,
                "info": "The description of the agent. This is only used when in Tool Mode. Defaults to 'A helpful assistant with access to the following tools:' and tools are added dynamically. This feature is deprecated and will be removed in future versions.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "agent_description",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "A helpful assistant with access to the following tools:"
              },
              "code": {
                "advanced": true,
                "dynamic": true,
                "fileTypes": [],
                "file_path": "",
                "info": "",
                "list": false,
                "load_from_db": false,
                "multiline": true,
                "name": "code",
                "password": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "type": "code",
                "value": "import json\r\nimport re\r\n\r\nfrom langchain_core.tools import StructuredTool, Tool\r\nfrom pydantic import ValidationError\r\n\r\nfrom lfx.base.agents.agent import LCToolsAgentComponent\r\nfrom lfx.base.agents.events import ExceptionWithMessageError\r\nfrom lfx.base.models.model_utils import get_model_name\r\nfrom lfx.components.helpers import CurrentDateComponent\r\nfrom lfx.components.langchain_utilities.tool_calling import ToolCallingAgentComponent\r\nfrom lfx.components.models_and_agents.memory import MemoryComponent\r\nfrom lfx.custom.custom_component.component import get_component_toolkit\r\nfrom lfx.io import BoolInput, IntInput, MessageTextInput, MultilineInput, Output, TableInput, HandleInput\r\nfrom lfx.log.logger import logger\r\nfrom lfx.schema.data import Data\r\nfrom lfx.schema.dotdict import dotdict\r\nfrom lfx.schema.message import Message\r\nfrom lfx.schema.table import EditMode\r\n\r\nclass AgentComponent(ToolCallingAgentComponent):\r\n    display_name: str = \"Review Intelligence Agent\"\r\n    description: str = \"Agent with connected LLM, instructions, and tool support.\"\r\n    documentation: str = \"https://docs.langflow.org/agents\"\r\n    icon = \"bot\"\r\n    name = \"CustomAgent\"\r\n\r\n    inputs = [\r\n        # REPLACED Model Provider/API Key with a direct Language Model handle\r\n        HandleInput(\r\n            name=\"llm\",\r\n            display_name=\"Language Model\",\r\n            input_types=[\"LanguageModel\"],\r\n            info=\"Connect a Language Model component here (e.g., OpenAI, Anthropic).\",\r\n            required=True\r\n        ),\r\n        MultilineInput(\r\n            name=\"system_prompt\",\r\n            display_name=\"Agent Instructions\",\r\n            info=\"System Prompt: Initial instructions and context provided to guide the agent's behavior.\",\r\n            value=\"You are a helpful assistant that can use tools to answer questions and perform tasks.\",\r\n            advanced=False,\r\n        ),\r\n        MessageTextInput(\r\n            name=\"input_value\",\r\n            display_name=\"Input Value\",\r\n            info=\"The user message or task for the agent.\",\r\n            required=True\r\n        ),\r\n        MessageTextInput(\r\n            name=\"context_id\",\r\n            display_name=\"Context ID\",\r\n            info=\"The context ID of the chat. Adds an extra layer to the local memory.\",\r\n            value=\"\",\r\n            advanced=True,\r\n        ),\r\n        IntInput(\r\n            name=\"n_messages\",\r\n            display_name=\"Number of Chat History Messages\",\r\n            value=100,\r\n            info=\"Number of chat history messages to retrieve.\",\r\n            advanced=True,\r\n            show=True,\r\n        ),\r\n        MultilineInput(\r\n            name=\"format_instructions\",\r\n            display_name=\"Output Format Instructions\",\r\n            info=\"Generic Template for structured output formatting.\",\r\n            value=(\r\n                \"You are an AI that extracts structured JSON objects. \"\r\n                \"Always return valid JSON.\"\r\n            ),\r\n            advanced=True,\r\n        ),\r\n        TableInput(\r\n            name=\"output_schema\",\r\n            display_name=\"Output Schema\",\r\n            info=\"Schema Validation: Define the structure for structured output.\",\r\n            advanced=True,\r\n            required=False,\r\n            value=[],\r\n            table_schema=[\r\n                {\"name\": \"name\", \"display_name\": \"Name\", \"type\": \"str\", \"edit_mode\": EditMode.INLINE},\r\n                {\"name\": \"description\", \"display_name\": \"Description\", \"type\": \"str\", \"edit_mode\": EditMode.POPOVER},\r\n                {\"name\": \"type\", \"display_name\": \"Type\", \"type\": \"str\", \"options\": [\"str\", \"int\", \"float\", \"bool\", \"dict\"], \"edit_mode\": EditMode.INLINE},\r\n                {\"name\": \"multiple\", \"display_name\": \"As List\", \"type\": \"boolean\", \"edit_mode\": EditMode.INLINE},\r\n            ],\r\n        ),\r\n        *LCToolsAgentComponent.get_base_inputs(),\r\n        BoolInput(\r\n            name=\"add_current_date_tool\",\r\n            display_name=\"Current Date\",\r\n            advanced=True,\r\n            info=\"If true, adds a tool that returns the current date.\",\r\n            value=True,\r\n        ),\r\n    ]\r\n    \r\n    outputs = [\r\n        Output(name=\"response\", display_name=\"Response\", method=\"message_response\"),\r\n    ]\r\n\r\n    async def get_agent_requirements(self):\r\n        # Directly use the connected llm handle\r\n        llm_model = self.llm\r\n        if llm_model is None:\r\n            raise ValueError(\"No language model connected.\")\r\n        \r\n        self.model_name = get_model_name(llm_model)\r\n\r\n        # Get memory data\r\n        self.chat_history = await self.get_memory_data()\r\n        if isinstance(self.chat_history, Message):\r\n            self.chat_history = [self.chat_history]\r\n\r\n        # Add current date tool if enabled\r\n        if self.add_current_date_tool:\r\n            if not hasattr(self, \"tools\") or not isinstance(self.tools, list):\r\n                self.tools = []\r\n            \r\n            # Helper to get base args for component initialization\r\n            current_date_tool_list = await CurrentDateComponent().to_toolkit()\r\n            if current_date_tool_list:\r\n                current_date_tool = current_date_tool_list[0]\r\n                self.tools.append(current_date_tool)\r\n\r\n        self.set_tools_callbacks(self.tools, self._get_shared_callbacks())\r\n        return llm_model, self.chat_history, self.tools\r\n\r\n    async def message_response(self) -> Message:\r\n        llm_model, self.chat_history, self.tools = await self.get_agent_requirements()\r\n        \r\n        self.set(\r\n            llm=llm_model,\r\n            tools=self.tools or [],\r\n            chat_history=self.chat_history,\r\n            input_value=self.input_value,\r\n            system_prompt=self.system_prompt,\r\n        )\r\n        \r\n        agent = self.create_agent_runnable()\r\n        result = await self.run_agent(agent)\r\n        return result\r\n\r\n    async def get_memory_data(self):\r\n        messages = (\r\n            await MemoryComponent()\r\n            .set(\r\n                session_id=self.graph.session_id if hasattr(self, \"graph\") else \"default\",\r\n                context_id=self.context_id,\r\n                order=\"Ascending\",\r\n                n_messages=self.n_messages,\r\n            )\r\n            .retrieve_messages()\r\n        )\r\n        # Filter to avoid echoing the current input if it's already in the DB\r\n        return [\r\n            msg for msg in messages \r\n            if getattr(msg, \"id\", None) != getattr(self.input_value, \"id\", None)\r\n        ]\r\n\r\n    # Simplified Tool building for custom component\r\n    async def _get_tools(self) -> list[Tool]:\r\n        component_toolkit = get_component_toolkit()\r\n        tools = component_toolkit(component=self).get_tools(\r\n            tool_name=\"Call_Agent\",\r\n            tool_description=self.get_tool_description(),\r\n            callbacks=self.get_langchain_callbacks(),\r\n        )\r\n        return tools"
              },
              "context_id": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "Context ID",
                "dynamic": false,
                "info": "The context ID of the chat. Adds an extra layer to the local memory.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "context_id",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "format_instructions": {
                "_input_type": "MultilineInput",
                "advanced": true,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Output Format Instructions",
                "dynamic": false,
                "info": "Generic Template for structured output formatting.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "format_instructions",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "You are an AI that extracts structured JSON objects. Always return valid JSON."
              },
              "handle_parsing_errors": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Handle Parse Errors",
                "dynamic": false,
                "info": "Should the Agent fix errors when reading user input for better processing?",
                "list": false,
                "list_add_label": "Add More",
                "name": "handle_parsing_errors",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              },
              "input_value": {
                "_input_type": "MessageInput",
                "advanced": false,
                "display_name": "Input",
                "dynamic": false,
                "info": "The input provided by the user for the agent to process.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "input_value",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": true,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "llm": {
                "_input_type": "HandleInput",
                "advanced": false,
                "display_name": "Language Model",
                "dynamic": false,
                "info": "Connect a Language Model component here (e.g., OpenAI, Anthropic).",
                "input_types": [
                  "LanguageModel"
                ],
                "list": false,
                "list_add_label": "Add More",
                "name": "llm",
                "override_skip": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "other",
                "value": ""
              },
              "max_iterations": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Max Iterations",
                "dynamic": false,
                "info": "The maximum number of attempts the agent can make to complete its task before it stops.",
                "list": false,
                "list_add_label": "Add More",
                "name": "max_iterations",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": 15
              },
              "n_messages": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Number of Chat History Messages",
                "dynamic": false,
                "info": "Number of chat history messages to retrieve.",
                "list": false,
                "list_add_label": "Add More",
                "name": "n_messages",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": 100
              },
              "output_schema": {
                "_input_type": "TableInput",
                "advanced": true,
                "display_name": "Output Schema",
                "dynamic": false,
                "info": "Schema Validation: Define the structure for structured output.",
                "is_list": true,
                "list_add_label": "Add More",
                "name": "output_schema",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "table_icon": "Table",
                "table_schema": [
                  {
                    "display_name": "Name",
                    "edit_mode": "inline",
                    "name": "name",
                    "type": "str"
                  },
                  {
                    "display_name": "Description",
                    "edit_mode": "popover",
                    "name": "description",
                    "type": "str"
                  },
                  {
                    "display_name": "Type",
                    "edit_mode": "inline",
                    "name": "type",
                    "options": [
                      "str",
                      "int",
                      "float",
                      "bool",
                      "dict"
                    ],
                    "type": "str"
                  },
                  {
                    "display_name": "As List",
                    "edit_mode": "inline",
                    "name": "multiple",
                    "type": "boolean"
                  }
                ],
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "trigger_icon": "Table",
                "trigger_text": "Open table",
                "type": "table",
                "value": []
              },
              "system_prompt": {
                "_input_type": "MultilineInput",
                "advanced": false,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Agent Instructions",
                "dynamic": false,
                "info": "System Prompt: Initial instructions and context provided to guide the agent's behavior.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "system_prompt",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "You are a Review Intelligence Agent.\n\nYour task:\n- Evaluate user feedback quality.\n- Ignore unreliable or misleading opinions.\n- Summarize genuine strengths and weaknesses.\n\nOutput:\n{\n  \"product_id\": \"\",\n  \"sentiment\": \"positive|mixed|negative\",\n  \"credibility_score\": 0-100,\n  \"pros\": [],\n  \"cons\": []\n}\n\nRemain neutral and balanced.\n"
              },
              "tools": {
                "_input_type": "HandleInput",
                "advanced": false,
                "display_name": "Tools",
                "dynamic": false,
                "info": "These are the tools that the agent can use to help with tasks.",
                "input_types": [
                  "Tool"
                ],
                "list": true,
                "list_add_label": "Add More",
                "name": "tools",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "other",
                "value": ""
              },
              "verbose": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Verbose",
                "dynamic": false,
                "info": "",
                "list": false,
                "list_add_label": "Add More",
                "name": "verbose",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              }
            },
            "tool_mode": false
          },
          "showNode": true,
          "type": "CustomAgent (yh5AE)"
        },
        "dragging": false,
        "id": "CustomAgent (yh5AE)-O2C2m",
        "measured": {
          "height": 391,
          "width": 320
        },
        "position": {
          "x": 1676.9779213064955,
          "y": 182.1424368542411
        },
        "selected": false,
        "type": "genericNode"
      },
      {
        "data": {
          "id": "CustomAgent (huvYE)-DYRDM",
          "node": {
            "base_classes": [
              "Message"
            ],
            "beta": false,
            "conditional_paths": [],
            "custom_fields": {},
            "description": "Agent with connected LLM, instructions, and tool support.",
            "display_name": "Pricing & Availability Agent",
            "documentation": "https://docs.langflow.org/agents",
            "edited": true,
            "field_order": [
              "llm",
              "system_prompt",
              "input_value",
              "context_id",
              "n_messages",
              "format_instructions",
              "output_schema",
              "tools",
              "input_value",
              "handle_parsing_errors",
              "verbose",
              "max_iterations",
              "agent_description",
              "add_current_date_tool"
            ],
            "frozen": false,
            "icon": "bot",
            "legacy": false,
            "lf_version": "1.7.1",
            "metadata": {
              "code_hash": "aad123219239",
              "dependencies": {
                "dependencies": [
                  {
                    "name": "langchain_core",
                    "version": "0.3.81"
                  },
                  {
                    "name": "pydantic",
                    "version": "2.11.10"
                  },
                  {
                    "name": "lfx",
                    "version": "0.2.1"
                  }
                ],
                "total_dependencies": 3
              },
              "module": "custom_components.pricing__availability_agent"
            },
            "minimized": false,
            "official": false,
            "output_types": [],
            "outputs": [
              {
                "allows_loop": false,
                "cache": true,
                "display_name": "Response",
                "group_outputs": false,
                "hidden": null,
                "loop_types": null,
                "method": "message_response",
                "name": "response",
                "options": null,
                "required_inputs": null,
                "selected": "Message",
                "tool_mode": true,
                "types": [
                  "Message"
                ],
                "value": "__UNDEFINED__"
              }
            ],
            "pinned": false,
            "template": {
              "_type": "Component",
              "add_current_date_tool": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Current Date",
                "dynamic": false,
                "info": "If true, adds a tool that returns the current date.",
                "list": false,
                "list_add_label": "Add More",
                "name": "add_current_date_tool",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              },
              "agent_description": {
                "_input_type": "MultilineInput",
                "advanced": true,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Agent Description [Deprecated]",
                "dynamic": false,
                "info": "The description of the agent. This is only used when in Tool Mode. Defaults to 'A helpful assistant with access to the following tools:' and tools are added dynamically. This feature is deprecated and will be removed in future versions.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "agent_description",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "A helpful assistant with access to the following tools:"
              },
              "code": {
                "advanced": true,
                "dynamic": true,
                "fileTypes": [],
                "file_path": "",
                "info": "",
                "list": false,
                "load_from_db": false,
                "multiline": true,
                "name": "code",
                "password": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "type": "code",
                "value": "import json\r\nimport re\r\n\r\nfrom langchain_core.tools import StructuredTool, Tool\r\nfrom pydantic import ValidationError\r\n\r\nfrom lfx.base.agents.agent import LCToolsAgentComponent\r\nfrom lfx.base.agents.events import ExceptionWithMessageError\r\nfrom lfx.base.models.model_utils import get_model_name\r\nfrom lfx.components.helpers import CurrentDateComponent\r\nfrom lfx.components.langchain_utilities.tool_calling import ToolCallingAgentComponent\r\nfrom lfx.components.models_and_agents.memory import MemoryComponent\r\nfrom lfx.custom.custom_component.component import get_component_toolkit\r\nfrom lfx.io import BoolInput, IntInput, MessageTextInput, MultilineInput, Output, TableInput, HandleInput\r\nfrom lfx.log.logger import logger\r\nfrom lfx.schema.data import Data\r\nfrom lfx.schema.dotdict import dotdict\r\nfrom lfx.schema.message import Message\r\nfrom lfx.schema.table import EditMode\r\n\r\nclass AgentComponent(ToolCallingAgentComponent):\r\n    display_name: str = \"Pricing & Availability Agent\"\r\n    description: str = \"Agent with connected LLM, instructions, and tool support.\"\r\n    documentation: str = \"https://docs.langflow.org/agents\"\r\n    icon = \"bot\"\r\n    name = \"CustomAgent\"\r\n\r\n    inputs = [\r\n        # REPLACED Model Provider/API Key with a direct Language Model handle\r\n        HandleInput(\r\n            name=\"llm\",\r\n            display_name=\"Language Model\",\r\n            input_types=[\"LanguageModel\"],\r\n            info=\"Connect a Language Model component here (e.g., OpenAI, Anthropic).\",\r\n            required=True\r\n        ),\r\n        MultilineInput(\r\n            name=\"system_prompt\",\r\n            display_name=\"Agent Instructions\",\r\n            info=\"System Prompt: Initial instructions and context provided to guide the agent's behavior.\",\r\n            value=\"You are a helpful assistant that can use tools to answer questions and perform tasks.\",\r\n            advanced=False,\r\n        ),\r\n        MessageTextInput(\r\n            name=\"input_value\",\r\n            display_name=\"Input Value\",\r\n            info=\"The user message or task for the agent.\",\r\n            required=True\r\n        ),\r\n        MessageTextInput(\r\n            name=\"context_id\",\r\n            display_name=\"Context ID\",\r\n            info=\"The context ID of the chat. Adds an extra layer to the local memory.\",\r\n            value=\"\",\r\n            advanced=True,\r\n        ),\r\n        IntInput(\r\n            name=\"n_messages\",\r\n            display_name=\"Number of Chat History Messages\",\r\n            value=100,\r\n            info=\"Number of chat history messages to retrieve.\",\r\n            advanced=True,\r\n            show=True,\r\n        ),\r\n        MultilineInput(\r\n            name=\"format_instructions\",\r\n            display_name=\"Output Format Instructions\",\r\n            info=\"Generic Template for structured output formatting.\",\r\n            value=(\r\n                \"You are an AI that extracts structured JSON objects. \"\r\n                \"Always return valid JSON.\"\r\n            ),\r\n            advanced=True,\r\n        ),\r\n        TableInput(\r\n            name=\"output_schema\",\r\n            display_name=\"Output Schema\",\r\n            info=\"Schema Validation: Define the structure for structured output.\",\r\n            advanced=True,\r\n            required=False,\r\n            value=[],\r\n            table_schema=[\r\n                {\"name\": \"name\", \"display_name\": \"Name\", \"type\": \"str\", \"edit_mode\": EditMode.INLINE},\r\n                {\"name\": \"description\", \"display_name\": \"Description\", \"type\": \"str\", \"edit_mode\": EditMode.POPOVER},\r\n                {\"name\": \"type\", \"display_name\": \"Type\", \"type\": \"str\", \"options\": [\"str\", \"int\", \"float\", \"bool\", \"dict\"], \"edit_mode\": EditMode.INLINE},\r\n                {\"name\": \"multiple\", \"display_name\": \"As List\", \"type\": \"boolean\", \"edit_mode\": EditMode.INLINE},\r\n            ],\r\n        ),\r\n        *LCToolsAgentComponent.get_base_inputs(),\r\n        BoolInput(\r\n            name=\"add_current_date_tool\",\r\n            display_name=\"Current Date\",\r\n            advanced=True,\r\n            info=\"If true, adds a tool that returns the current date.\",\r\n            value=True,\r\n        ),\r\n    ]\r\n    \r\n    outputs = [\r\n        Output(name=\"response\", display_name=\"Response\", method=\"message_response\"),\r\n    ]\r\n\r\n    async def get_agent_requirements(self):\r\n        # Directly use the connected llm handle\r\n        llm_model = self.llm\r\n        if llm_model is None:\r\n            raise ValueError(\"No language model connected.\")\r\n        \r\n        self.model_name = get_model_name(llm_model)\r\n\r\n        # Get memory data\r\n        self.chat_history = await self.get_memory_data()\r\n        if isinstance(self.chat_history, Message):\r\n            self.chat_history = [self.chat_history]\r\n\r\n        # Add current date tool if enabled\r\n        if self.add_current_date_tool:\r\n            if not hasattr(self, \"tools\") or not isinstance(self.tools, list):\r\n                self.tools = []\r\n            \r\n            # Helper to get base args for component initialization\r\n            current_date_tool_list = await CurrentDateComponent().to_toolkit()\r\n            if current_date_tool_list:\r\n                current_date_tool = current_date_tool_list[0]\r\n                self.tools.append(current_date_tool)\r\n\r\n        self.set_tools_callbacks(self.tools, self._get_shared_callbacks())\r\n        return llm_model, self.chat_history, self.tools\r\n\r\n    async def message_response(self) -> Message:\r\n        llm_model, self.chat_history, self.tools = await self.get_agent_requirements()\r\n        \r\n        self.set(\r\n            llm=llm_model,\r\n            tools=self.tools or [],\r\n            chat_history=self.chat_history,\r\n            input_value=self.input_value,\r\n            system_prompt=self.system_prompt,\r\n        )\r\n        \r\n        agent = self.create_agent_runnable()\r\n        result = await self.run_agent(agent)\r\n        return result\r\n\r\n    async def get_memory_data(self):\r\n        messages = (\r\n            await MemoryComponent()\r\n            .set(\r\n                session_id=self.graph.session_id if hasattr(self, \"graph\") else \"default\",\r\n                context_id=self.context_id,\r\n                order=\"Ascending\",\r\n                n_messages=self.n_messages,\r\n            )\r\n            .retrieve_messages()\r\n        )\r\n        # Filter to avoid echoing the current input if it's already in the DB\r\n        return [\r\n            msg for msg in messages \r\n            if getattr(msg, \"id\", None) != getattr(self.input_value, \"id\", None)\r\n        ]\r\n\r\n    # Simplified Tool building for custom component\r\n    async def _get_tools(self) -> list[Tool]:\r\n        component_toolkit = get_component_toolkit()\r\n        tools = component_toolkit(component=self).get_tools(\r\n            tool_name=\"Call_Agent\",\r\n            tool_description=self.get_tool_description(),\r\n            callbacks=self.get_langchain_callbacks(),\r\n        )\r\n        return tools"
              },
              "context_id": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "Context ID",
                "dynamic": false,
                "info": "The context ID of the chat. Adds an extra layer to the local memory.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "context_id",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "format_instructions": {
                "_input_type": "MultilineInput",
                "advanced": true,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Output Format Instructions",
                "dynamic": false,
                "info": "Generic Template for structured output formatting.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "format_instructions",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "You are an AI that extracts structured JSON objects. Always return valid JSON."
              },
              "handle_parsing_errors": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Handle Parse Errors",
                "dynamic": false,
                "info": "Should the Agent fix errors when reading user input for better processing?",
                "list": false,
                "list_add_label": "Add More",
                "name": "handle_parsing_errors",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              },
              "input_value": {
                "_input_type": "MessageInput",
                "advanced": false,
                "display_name": "Input",
                "dynamic": false,
                "info": "The input provided by the user for the agent to process.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "input_value",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": true,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "llm": {
                "_input_type": "HandleInput",
                "advanced": false,
                "display_name": "Language Model",
                "dynamic": false,
                "info": "Connect a Language Model component here (e.g., OpenAI, Anthropic).",
                "input_types": [
                  "LanguageModel"
                ],
                "list": false,
                "list_add_label": "Add More",
                "name": "llm",
                "override_skip": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "other",
                "value": ""
              },
              "max_iterations": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Max Iterations",
                "dynamic": false,
                "info": "The maximum number of attempts the agent can make to complete its task before it stops.",
                "list": false,
                "list_add_label": "Add More",
                "name": "max_iterations",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": 15
              },
              "n_messages": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Number of Chat History Messages",
                "dynamic": false,
                "info": "Number of chat history messages to retrieve.",
                "list": false,
                "list_add_label": "Add More",
                "name": "n_messages",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": 100
              },
              "output_schema": {
                "_input_type": "TableInput",
                "advanced": true,
                "display_name": "Output Schema",
                "dynamic": false,
                "info": "Schema Validation: Define the structure for structured output.",
                "is_list": true,
                "list_add_label": "Add More",
                "name": "output_schema",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "table_icon": "Table",
                "table_schema": [
                  {
                    "display_name": "Name",
                    "edit_mode": "inline",
                    "name": "name",
                    "type": "str"
                  },
                  {
                    "display_name": "Description",
                    "edit_mode": "popover",
                    "name": "description",
                    "type": "str"
                  },
                  {
                    "display_name": "Type",
                    "edit_mode": "inline",
                    "name": "type",
                    "options": [
                      "str",
                      "int",
                      "float",
                      "bool",
                      "dict"
                    ],
                    "type": "str"
                  },
                  {
                    "display_name": "As List",
                    "edit_mode": "inline",
                    "name": "multiple",
                    "type": "boolean"
                  }
                ],
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "trigger_icon": "Table",
                "trigger_text": "Open table",
                "type": "table",
                "value": []
              },
              "system_prompt": {
                "_input_type": "MultilineInput",
                "advanced": false,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Agent Instructions",
                "dynamic": false,
                "info": "System Prompt: Initial instructions and context provided to guide the agent's behavior.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "system_prompt",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "You are a Pricing & Availability Agent.\n\nYour task:\n- Determine the most favorable current offer.\n- Identify discounts and urgency signals.\n- Report availability status clearly.\n\nOutput:\n{\n  \"product_id\": \"\",\n  \"best_price\": \"\",\n  \"platform\": \"\",\n  \"discount_percentage\": \"\",\n  \"stock_status\": \"in_stock|low_stock|out_of_stock\"\n}\n\nDo not speculate beyond current conditions.\n"
              },
              "tools": {
                "_input_type": "HandleInput",
                "advanced": false,
                "display_name": "Tools",
                "dynamic": false,
                "info": "These are the tools that the agent can use to help with tasks.",
                "input_types": [
                  "Tool"
                ],
                "list": true,
                "list_add_label": "Add More",
                "name": "tools",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "other",
                "value": ""
              },
              "verbose": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Verbose",
                "dynamic": false,
                "info": "",
                "list": false,
                "list_add_label": "Add More",
                "name": "verbose",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              }
            },
            "tool_mode": false
          },
          "showNode": true,
          "type": "CustomAgent (huvYE)"
        },
        "dragging": false,
        "id": "CustomAgent (huvYE)-DYRDM",
        "measured": {
          "height": 391,
          "width": 320
        },
        "position": {
          "x": 2147.066841436026,
          "y": 209.79472627362523
        },
        "selected": false,
        "type": "genericNode"
      },
      {
        "data": {
          "id": "CustomAgent (DMwhm)-Bmybo",
          "node": {
            "base_classes": [
              "Message"
            ],
            "beta": false,
            "conditional_paths": [],
            "custom_fields": {},
            "description": "Agent with connected LLM, instructions, and tool support.",
            "display_name": "Unified Recommendation Agent",
            "documentation": "https://docs.langflow.org/agents",
            "edited": true,
            "field_order": [
              "llm",
              "system_prompt",
              "input_value",
              "context_id",
              "n_messages",
              "format_instructions",
              "output_schema",
              "tools",
              "input_value",
              "handle_parsing_errors",
              "verbose",
              "max_iterations",
              "agent_description",
              "add_current_date_tool"
            ],
            "frozen": false,
            "icon": "bot",
            "legacy": false,
            "lf_version": "1.7.1",
            "metadata": {
              "code_hash": "3e3a7a98f0d5",
              "dependencies": {
                "dependencies": [
                  {
                    "name": "langchain_core",
                    "version": "0.3.81"
                  },
                  {
                    "name": "pydantic",
                    "version": "2.11.10"
                  },
                  {
                    "name": "lfx",
                    "version": "0.2.1"
                  }
                ],
                "total_dependencies": 3
              },
              "module": "custom_components.unified_recommendation_agent"
            },
            "minimized": false,
            "official": false,
            "output_types": [],
            "outputs": [
              {
                "allows_loop": false,
                "cache": true,
                "display_name": "Response",
                "group_outputs": false,
                "hidden": null,
                "loop_types": null,
                "method": "message_response",
                "name": "response",
                "options": null,
                "required_inputs": null,
                "selected": "Message",
                "tool_mode": true,
                "types": [
                  "Message"
                ],
                "value": "__UNDEFINED__"
              }
            ],
            "pinned": false,
            "template": {
              "_type": "Component",
              "add_current_date_tool": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Current Date",
                "dynamic": false,
                "info": "If true, adds a tool that returns the current date.",
                "list": false,
                "list_add_label": "Add More",
                "name": "add_current_date_tool",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              },
              "agent_description": {
                "_input_type": "MultilineInput",
                "advanced": true,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Agent Description [Deprecated]",
                "dynamic": false,
                "info": "The description of the agent. This is only used when in Tool Mode. Defaults to 'A helpful assistant with access to the following tools:' and tools are added dynamically. This feature is deprecated and will be removed in future versions.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "agent_description",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "A helpful assistant with access to the following tools:"
              },
              "code": {
                "advanced": true,
                "dynamic": true,
                "fileTypes": [],
                "file_path": "",
                "info": "",
                "list": false,
                "load_from_db": false,
                "multiline": true,
                "name": "code",
                "password": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "type": "code",
                "value": "import json\r\nimport re\r\n\r\nfrom langchain_core.tools import StructuredTool, Tool\r\nfrom pydantic import ValidationError\r\n\r\nfrom lfx.base.agents.agent import LCToolsAgentComponent\r\nfrom lfx.base.agents.events import ExceptionWithMessageError\r\nfrom lfx.base.models.model_utils import get_model_name\r\nfrom lfx.components.helpers import CurrentDateComponent\r\nfrom lfx.components.langchain_utilities.tool_calling import ToolCallingAgentComponent\r\nfrom lfx.components.models_and_agents.memory import MemoryComponent\r\nfrom lfx.custom.custom_component.component import get_component_toolkit\r\nfrom lfx.io import BoolInput, IntInput, MessageTextInput, MultilineInput, Output, TableInput, HandleInput\r\nfrom lfx.log.logger import logger\r\nfrom lfx.schema.data import Data\r\nfrom lfx.schema.dotdict import dotdict\r\nfrom lfx.schema.message import Message\r\nfrom lfx.schema.table import EditMode\r\n\r\nclass AgentComponent(ToolCallingAgentComponent):\r\n    display_name: str = \"Unified Recommendation Agent\"\r\n    description: str = \"Agent with connected LLM, instructions, and tool support.\"\r\n    documentation: str = \"https://docs.langflow.org/agents\"\r\n    icon = \"bot\"\r\n    name = \"CustomAgent\"\r\n\r\n    inputs = [\r\n        # REPLACED Model Provider/API Key with a direct Language Model handle\r\n        HandleInput(\r\n            name=\"llm\",\r\n            display_name=\"Language Model\",\r\n            input_types=[\"LanguageModel\"],\r\n            info=\"Connect a Language Model component here (e.g., OpenAI, Anthropic).\",\r\n            required=True\r\n        ),\r\n        MultilineInput(\r\n            name=\"system_prompt\",\r\n            display_name=\"Agent Instructions\",\r\n            info=\"System Prompt: Initial instructions and context provided to guide the agent's behavior.\",\r\n            value=\"You are a helpful assistant that can use tools to answer questions and perform tasks.\",\r\n            advanced=False,\r\n        ),\r\n        MessageTextInput(\r\n            name=\"input_value\",\r\n            display_name=\"Input Value\",\r\n            info=\"The user message or task for the agent.\",\r\n            required=True\r\n        ),\r\n        MessageTextInput(\r\n            name=\"context_id\",\r\n            display_name=\"Context ID\",\r\n            info=\"The context ID of the chat. Adds an extra layer to the local memory.\",\r\n            value=\"\",\r\n            advanced=True,\r\n        ),\r\n        IntInput(\r\n            name=\"n_messages\",\r\n            display_name=\"Number of Chat History Messages\",\r\n            value=100,\r\n            info=\"Number of chat history messages to retrieve.\",\r\n            advanced=True,\r\n            show=True,\r\n        ),\r\n        MultilineInput(\r\n            name=\"format_instructions\",\r\n            display_name=\"Output Format Instructions\",\r\n            info=\"Generic Template for structured output formatting.\",\r\n            value=(\r\n                \"You are an AI that extracts structured JSON objects. \"\r\n                \"Always return valid JSON.\"\r\n            ),\r\n            advanced=True,\r\n        ),\r\n        TableInput(\r\n            name=\"output_schema\",\r\n            display_name=\"Output Schema\",\r\n            info=\"Schema Validation: Define the structure for structured output.\",\r\n            advanced=True,\r\n            required=False,\r\n            value=[],\r\n            table_schema=[\r\n                {\"name\": \"name\", \"display_name\": \"Name\", \"type\": \"str\", \"edit_mode\": EditMode.INLINE},\r\n                {\"name\": \"description\", \"display_name\": \"Description\", \"type\": \"str\", \"edit_mode\": EditMode.POPOVER},\r\n                {\"name\": \"type\", \"display_name\": \"Type\", \"type\": \"str\", \"options\": [\"str\", \"int\", \"float\", \"bool\", \"dict\"], \"edit_mode\": EditMode.INLINE},\r\n                {\"name\": \"multiple\", \"display_name\": \"As List\", \"type\": \"boolean\", \"edit_mode\": EditMode.INLINE},\r\n            ],\r\n        ),\r\n        *LCToolsAgentComponent.get_base_inputs(),\r\n        BoolInput(\r\n            name=\"add_current_date_tool\",\r\n            display_name=\"Current Date\",\r\n            advanced=True,\r\n            info=\"If true, adds a tool that returns the current date.\",\r\n            value=True,\r\n        ),\r\n    ]\r\n    \r\n    outputs = [\r\n        Output(name=\"response\", display_name=\"Response\", method=\"message_response\"),\r\n    ]\r\n\r\n    async def get_agent_requirements(self):\r\n        # Directly use the connected llm handle\r\n        llm_model = self.llm\r\n        if llm_model is None:\r\n            raise ValueError(\"No language model connected.\")\r\n        \r\n        self.model_name = get_model_name(llm_model)\r\n\r\n        # Get memory data\r\n        self.chat_history = await self.get_memory_data()\r\n        if isinstance(self.chat_history, Message):\r\n            self.chat_history = [self.chat_history]\r\n\r\n        # Add current date tool if enabled\r\n        if self.add_current_date_tool:\r\n            if not hasattr(self, \"tools\") or not isinstance(self.tools, list):\r\n                self.tools = []\r\n            \r\n            # Helper to get base args for component initialization\r\n            current_date_tool_list = await CurrentDateComponent().to_toolkit()\r\n            if current_date_tool_list:\r\n                current_date_tool = current_date_tool_list[0]\r\n                self.tools.append(current_date_tool)\r\n\r\n        self.set_tools_callbacks(self.tools, self._get_shared_callbacks())\r\n        return llm_model, self.chat_history, self.tools\r\n\r\n    async def message_response(self) -> Message:\r\n        llm_model, self.chat_history, self.tools = await self.get_agent_requirements()\r\n        \r\n        self.set(\r\n            llm=llm_model,\r\n            tools=self.tools or [],\r\n            chat_history=self.chat_history,\r\n            input_value=self.input_value,\r\n            system_prompt=self.system_prompt,\r\n        )\r\n        \r\n        agent = self.create_agent_runnable()\r\n        result = await self.run_agent(agent)\r\n        return result\r\n\r\n    async def get_memory_data(self):\r\n        messages = (\r\n            await MemoryComponent()\r\n            .set(\r\n                session_id=self.graph.session_id if hasattr(self, \"graph\") else \"default\",\r\n                context_id=self.context_id,\r\n                order=\"Ascending\",\r\n                n_messages=self.n_messages,\r\n            )\r\n            .retrieve_messages()\r\n        )\r\n        # Filter to avoid echoing the current input if it's already in the DB\r\n        return [\r\n            msg for msg in messages \r\n            if getattr(msg, \"id\", None) != getattr(self.input_value, \"id\", None)\r\n        ]\r\n\r\n    # Simplified Tool building for custom component\r\n    async def _get_tools(self) -> list[Tool]:\r\n        component_toolkit = get_component_toolkit()\r\n        tools = component_toolkit(component=self).get_tools(\r\n            tool_name=\"Call_Agent\",\r\n            tool_description=self.get_tool_description(),\r\n            callbacks=self.get_langchain_callbacks(),\r\n        )\r\n        return tools"
              },
              "context_id": {
                "_input_type": "MessageTextInput",
                "advanced": true,
                "display_name": "Context ID",
                "dynamic": false,
                "info": "The context ID of the chat. Adds an extra layer to the local memory.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "context_id",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "format_instructions": {
                "_input_type": "MultilineInput",
                "advanced": true,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Output Format Instructions",
                "dynamic": false,
                "info": "Generic Template for structured output formatting.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "format_instructions",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "You are an AI that extracts structured JSON objects. Always return valid JSON."
              },
              "handle_parsing_errors": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Handle Parse Errors",
                "dynamic": false,
                "info": "Should the Agent fix errors when reading user input for better processing?",
                "list": false,
                "list_add_label": "Add More",
                "name": "handle_parsing_errors",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              },
              "input_value": {
                "_input_type": "MessageInput",
                "advanced": false,
                "display_name": "Input",
                "dynamic": false,
                "info": "The input provided by the user for the agent to process.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "name": "input_value",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": true,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": ""
              },
              "llm": {
                "_input_type": "HandleInput",
                "advanced": false,
                "display_name": "Language Model",
                "dynamic": false,
                "info": "Connect a Language Model component here (e.g., OpenAI, Anthropic).",
                "input_types": [
                  "LanguageModel"
                ],
                "list": false,
                "list_add_label": "Add More",
                "name": "llm",
                "override_skip": false,
                "placeholder": "",
                "required": true,
                "show": true,
                "title_case": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "other",
                "value": ""
              },
              "max_iterations": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Max Iterations",
                "dynamic": false,
                "info": "The maximum number of attempts the agent can make to complete its task before it stops.",
                "list": false,
                "list_add_label": "Add More",
                "name": "max_iterations",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": 15
              },
              "n_messages": {
                "_input_type": "IntInput",
                "advanced": true,
                "display_name": "Number of Chat History Messages",
                "dynamic": false,
                "info": "Number of chat history messages to retrieve.",
                "list": false,
                "list_add_label": "Add More",
                "name": "n_messages",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "int",
                "value": 100
              },
              "output_schema": {
                "_input_type": "TableInput",
                "advanced": true,
                "display_name": "Output Schema",
                "dynamic": false,
                "info": "Schema Validation: Define the structure for structured output.",
                "is_list": true,
                "list_add_label": "Add More",
                "name": "output_schema",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "table_icon": "Table",
                "table_schema": [
                  {
                    "display_name": "Name",
                    "edit_mode": "inline",
                    "name": "name",
                    "type": "str"
                  },
                  {
                    "display_name": "Description",
                    "edit_mode": "popover",
                    "name": "description",
                    "type": "str"
                  },
                  {
                    "display_name": "Type",
                    "edit_mode": "inline",
                    "name": "type",
                    "options": [
                      "str",
                      "int",
                      "float",
                      "bool",
                      "dict"
                    ],
                    "type": "str"
                  },
                  {
                    "display_name": "As List",
                    "edit_mode": "inline",
                    "name": "multiple",
                    "type": "boolean"
                  }
                ],
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "trigger_icon": "Table",
                "trigger_text": "Open table",
                "type": "table",
                "value": []
              },
              "system_prompt": {
                "_input_type": "MultilineInput",
                "advanced": false,
                "ai_enabled": false,
                "copy_field": false,
                "display_name": "Agent Instructions",
                "dynamic": false,
                "info": "System Prompt: Initial instructions and context provided to guide the agent's behavior.",
                "input_types": [
                  "Message"
                ],
                "list": false,
                "list_add_label": "Add More",
                "load_from_db": false,
                "multiline": true,
                "name": "system_prompt",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_input": true,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "str",
                "value": "You are a Unified Recommendation Agent.\n\nYour task:\n- Combine insights from all agents.\n- Rank the best options based on overall value.\n- Explain recommendations in simple terms.\n\nOutput:\n- Top 3 recommendations\n- Best budget option\n- Best overall option\n- Short comparison summary\n\nDo not introduce new information.\n"
              },
              "tools": {
                "_input_type": "HandleInput",
                "advanced": false,
                "display_name": "Tools",
                "dynamic": false,
                "info": "These are the tools that the agent can use to help with tasks.",
                "input_types": [
                  "Tool"
                ],
                "list": true,
                "list_add_label": "Add More",
                "name": "tools",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "trace_as_metadata": true,
                "track_in_telemetry": false,
                "type": "other",
                "value": ""
              },
              "verbose": {
                "_input_type": "BoolInput",
                "advanced": true,
                "display_name": "Verbose",
                "dynamic": false,
                "info": "",
                "list": false,
                "list_add_label": "Add More",
                "name": "verbose",
                "override_skip": false,
                "placeholder": "",
                "required": false,
                "show": true,
                "title_case": false,
                "tool_mode": false,
                "trace_as_metadata": true,
                "track_in_telemetry": true,
                "type": "bool",
                "value": true
              }
            },
            "tool_mode": false
          },
          "showNode": true,
          "type": "CustomAgent (DMwhm)"
        },
        "dragging": false,
        "id": "CustomAgent (DMwhm)-Bmybo",
        "measured": {
          "height": 391,
          "width": 320
        },
        "position": {
          "x": 2593.453799206084,
          "y": 276.95028629212965
        },
        "selected": false,
        "type": "genericNode"
      }
    ],
    "viewport": {
      "x": 16.384979743879285,
      "y": 171.16137468946658,
      "zoom": 0.4005456219674143
    }
  },
  "description": "Design, Develop, Dialogize.",
  "endpoint_name": null,
  "id": "497837db-2331-441c-bcdd-88e652728e3e",
  "is_component": false,
  "last_tested_version": "1.7.1",
  "name": "final flow ISA",
  "tags": []
}